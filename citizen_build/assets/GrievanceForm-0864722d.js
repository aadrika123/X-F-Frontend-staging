import{j as e}from"./mui-8e804a04.js";import{r as l,u as z}from"./router-87042356.js";import{V as B}from"./index.esm-9d7434c8.js";import{l as M,c as J,d,u as K,A as o,R as Q}from"./index-0f28b603.js";import{G as T}from"./GrievanceApiList-f1509de8.js";import"./react-09dd1212.js";import"./reactIcons-6a3b6da1.js";import"./axios-97164839.js";import"./redux-4db06ad6.js";import"./i18next-e99b4042.js";function ce(n){var q;const[j,E]=l.useState(null),[I,P]=l.useState(),[m,G]=l.useState(),[p,U]=l.useState(),[u,A]=l.useState(),[N,x]=l.useState(!1),[b,h]=l.useState(!1),[X,H]=l.useState(),{api_distList:C,api_getAllUlbList:D,api_wardListByUlb:_,api_grievanceApplyForm:L}=T(),{notify:f}=l.useContext(M);z();const $=J({applicantName:d().required("Require"),email:d().email("Invalid email address").required("Require"),gender:d().required("Require"),disability:d().required("Require"),grievanceHead:d().required("Require"),description:d().required("Require"),department:d().required("Require"),district:d().required("Require"),ulb:d().required("Require"),ward:d().required("Require"),fileUpload:d().required("Require")}),W={mobileNo:n==null?void 0:n.mobileNo,applicantName:"",email:"",aadhar:"",gender:"",disability:"",department:"",grievanceHead:"",description:"",district:"",ulb:"",ward:"",address:"",otherInfo:"",fileUpload:""},r=K({initialValues:W,enableReinitialize:!0,onSubmit:(s,i)=>{console.log("Value.....",s),Y(s)},validationSchema:$}),V=s=>{let i=s.target.name;if(s.target.value,i==="fileUpload"){const c=s.target.files[0],t=new FileReader;t.onload=()=>{E(t.result)},t.readAsDataURL(c),P(c)}},v=l.useRef(null),y=l.useRef(null),g=l.useRef(null),F=l.useRef(null),k=()=>{if(r.errors.applicantName)return v.current.focus();if(r.errors.email)return y.current.focus();if(r.errors.gender)return g.current.focus();if(r.errors.department)return F.current.focus()};l.useEffect(()=>{o.post(C,{}).then(s=>{s.data.status?(console.log("List of district",s),G(s.data.data)):console.log("Error while fetching district list",s)}).catch(s=>{console.log("Error while fetching district list",s)})},[]),l.useEffect(()=>{o.get(D).then(s=>{s.data.status?(console.log("List of district",s),U(s.data.data)):console.log("Error while fetching district list",s)}).catch(s=>{console.log("Error while fetching district list",s)})},[]);const O=()=>{o.post(_,{ulbId:2}).then(s=>{s.data.status?(console.log("List of Wards against ulb",s),A(s.data.data)):console.log("Error while fetching ward list",s)}).catch(s=>{console.log("Error while fetching ward list",s)})};l.useEffect(()=>{O()},[r.values.ulb]);const Y=s=>{var c;x();let i=new FormData;i.append("mobileNo",s.mobileNo),i.append("applicantName",s.applicantName),i.append("email",s.email),i.append("aadhar",s.aadhar),i.append("gender",s.gender),i.append("disability",s.disability),i.append("department",s.department),i.append("grievanceHead",s.grievanceHead),i.append("description",s.description),i.append("districtId",Number(s.district)),i.append("ulbId",s.ulb),i.append("wardId",s.ward),i.append("address",s.address),i.append("otherInfo",s.otherInfo),i.append("document",I||""),i.append("docCode","GRIEVANCE_DOC"),i.append("docCategory","GRIEVANCE_DOC"),console.log("Payload",i),h(!0),(c=o)==null||c.post(L,i).then(t=>{var w,S,R;h(!1),t.data.status?(console.log("GrievanceApply Successfully..",t),f("Grievance Submitted Successfully","success"),n.grievanceApplicationNo((S=(w=t==null?void 0:t.data)==null?void 0:w.data)==null?void 0:S.applicationNo),H((R=t==null?void 0:t.data)==null?void 0:R.applicationNo),n.screen()):(console.log("Failed to submit Grievance",t),f("Grievance not submitted","error"),x(t.data.message||"Failed to apply grievance"))}).catch(t=>{h(!1),f("Error while Grievance submitting","error"),console.log("Error While applying grievance",t),x("Error While applying grievance")})},a={filed:"flex-1 w-full px-4 py-2 text-base text-gray-800 placeholder-gray-400 bg-white border border-gray-300 focus:outline-none focus:ring-1 focus:ring-indigo-800 focus:border-transparent",required:"text-red-700 font-semibold"};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-5 py-6 rounded-lg border border-indigo-300 bg-white",children:[e.jsxs("p",{className:"absolute right-8 top-8 cursor-pointer bg-gray-100 hover:bg-gray-300",children:[" ",e.jsx(B,{size:30})," "]}),e.jsx("div",{className:"text-center text-lg",children:" Submit Your Grievance "}),e.jsx("div",{children:e.jsxs("form",{onSubmit:r.handleSubmit,onChange:V,onSubmitCapture:k,children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Mobile No",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{type:"text",disabled:!0,...r.getFieldProps("mobileNo"),name:"mobileNo",className:`${a.filed} disabled:bg-gray-200`})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Applicant Name",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{type:"text",...r.getFieldProps("applicantName"),name:"applicantName",ref:v,className:`${r.errors.applicantName&&"border-red-600"} ${a.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.applicantName&&r.errors.applicantName?r.errors.applicantName:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Email",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{type:"text",...r.getFieldProps("email"),name:"email",ref:y,className:` ${r.errors.email&&"border-red-600"} ${a.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.email&&r.errors.email?r.errors.email:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsx("label",{children:"Aadhar"}),e.jsx("input",{type:"text",...r.getFieldProps("aadhar"),name:"aadhar",className:`${a.filed}`}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.aadhar&&r.errors.aadhar?r.errors.aadhar:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("div",{className:"flex justify-start",children:[e.jsxs("label",{children:["Gender",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{type:"radio",...r.getFieldProps("gender"),name:"gender",ref:g,value:"male",className:"mx-2"}),"Male",e.jsx("input",{type:"radio",...r.getFieldProps("gender"),name:"gender",ref:g,value:"female",className:"mx-2"}),"Female"]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.gender&&r.errors.gender?r.errors.gender:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("div",{className:"flex justify-start",children:[e.jsxs("label",{children:["Specially abled ?",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{type:"radio",...r.getFieldProps("disability"),name:"disability",value:"true",className:"mx-2"}),"Yes",e.jsx("input",{type:"radio",...r.getFieldProps("disability"),name:"disability",value:"false",className:"mx-2"}),"No"]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.disability&&r.errors.disability?r.errors.disability:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select Department ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("department"),name:"department",ref:F,className:` ${r.errors.department&&"border-red-600"} ${a.filed}`,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Department 1"}),e.jsx("option",{value:"2",children:"Department 2"}),e.jsx("option",{value:"3",children:"Department 3"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.department&&r.errors.department?r.errors.department:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"grievanceHead",children:["Select Grievance Head ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("grievanceHead"),name:"grievanceHead",className:a.filed,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"1",children:"Grievance Head 1"}),e.jsx("option",{value:"2",children:"Grievance Head 2"}),e.jsx("option",{value:"3",children:"Grievance Head 3"})]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.grievanceHead&&r.errors.grievanceHead?r.errors.grievanceHead:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"description",children:["Write Description ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("description"),name:"description",className:a.filed,placeholder:"Enter your grievance",rows:"5",cols:"40"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.description&&r.errors.description?r.errors.description:null})]}),e.jsxs("div",{className:"md:grid md:grid-flow-col justify-stretch",children:[e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{children:["Select District ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("district"),name:"district",className:a.filed,children:[e.jsx("option",{children:"Select"}),m==null?void 0:m.map(s=>e.jsx("option",{value:s.district_code,children:s.district_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.district&&r.errors.district?r.errors.district:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"ulb",children:["Select ULB ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("ulb"),name:"ulb",className:a.filed,children:[e.jsx("option",{value:"",children:"Select"}),(q=p==null?void 0:p.filter(s=>s.district_id==r.values.district))==null?void 0:q.map(s=>e.jsx("option",{value:s.id,children:s.ulb_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.ulb&&r.errors.ulb?r.errors.ulb:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"ward",children:["Select Ward ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsxs("select",{...r.getFieldProps("ward"),name:"ward",className:a.filed,children:[e.jsx("option",{children:"Select"}),u==null?void 0:u.map(s=>e.jsx("option",{value:s.id,children:s.ward_name}))]}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.ward&&r.errors.ward?r.errors.ward:null})]})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"address",children:["Your Address ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("address"),name:"address",className:a.filed,placeholder:"Enter your address",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.address&&r.errors.address?r.errors.address:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"otherInfo",children:["Other Information ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})," ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("textarea",{...r.getFieldProps("otherInfo"),name:"otherInfo",className:a.filed,placeholder:"Other Information",rows:"2"}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.otherInfo&&r.errors.otherInfo?r.errors.otherInfo:null})]}),e.jsxs("div",{className:"m-3",children:[e.jsxs("label",{htmlFor:"fileUpload",children:["Upload File ",e.jsx("span",{className:"text-xs italic",children:"(optional)"})," ",e.jsx("span",{className:a.required,children:"*"})]}),e.jsx("input",{...r.getFieldProps("fileUpload"),type:"file",accept:"image/*",name:"fileUpload",className:a.filed}),e.jsx("p",{className:"text-red-500 text-xs",children:r.touched.fileUpload&&r.errors.fileUpload?r.errors.fileUpload:null})]}),e.jsx("div",{className:"flex justify-center",children:j&&e.jsx("img",{src:j,alt:"Preview",className:"border border-gray-300 px-4 py-2 rounded-lg mt-4 h-32"})}),e.jsx("p",{className:"text-center text-red-500 font-semibold",children:N&&N}),e.jsx("div",{className:"m-3 flex justify-center",children:e.jsx("button",{disabled:b,type:"submit",className:"px-4 py-2 mt-5 bg-indigo-600 hover:bg-indigo-700 text-gray-50 text-base shadow-md rounded-md",children:b?e.jsx("div",{children:e.jsx(Q,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})}):"Submit Grievances"})})]})})]})})}export{ce as default};
