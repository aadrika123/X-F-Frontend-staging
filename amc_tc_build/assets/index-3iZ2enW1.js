import{e as Ce,d as Te,Q as I,S as T,p as w,b as g,j as n}from"./index-Ouhqx-gm.js";import{P as ze}from"./index-tQd2beLj.js";import{e as ve,d as Ae}from"./router-vSHQYlWC.js";import{u as Se}from"./formik.esm-feHG9Gj_.js";import{c as _e,a as j}from"./index.esm-YegZWto1.js";import{F as Ve}from"./FormProvider-zfwHHTn9.js";import{T as m}from"./TextField-BtYHcQ4y.js";import{S as xe}from"./SelectField-3usZ9XS5.js";import{T as be}from"./TextAreaField-KAJ9gFxP.js";import"./TranslateField-LTFh77N4.js";import{r as Be}from"./resizeImage-mgfMD96o.js";import{r as z}from"./tailwind-nPCoKmcy.js";import{u as Fe}from"./useLocationRadius-fJsGq4TT.js";import"./reactQuery-xwoMMF6K.js";import"./axios-lPgvryBG.js";import"./reactIcons-jqXmw8S_.js";import"./headlessui-kWR29u24.js";import"./customInputValidation-jhKsg103.js";const qe=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function Le({getPropDetails:a,demandDetails:r,id:s}){var A,S,_,V,B,F,q,L,R,Z,E,U,W,M,O,Y,H,$,J,K,Q,X,G,k,P,D,ee,ae,ne,te,de,re,ie,oe,se,ce,le,me,ue,pe;const{calculateDistance:he}=Fe(),je=ve(),{coords:b,isGeolocationEnabled:v,isGeolocationAvailable:ye}=Ce(),Ne=Te({}),[fe,Ie]=Ae.useState(null),e=Se({enableReinitialize:!0,initialValues:{zoneName:((S=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:S.zone_name)||"",zoneId:((V=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:V.zone_mstr_id)||"",wardId:((F=(B=a==null?void 0:a.data)==null?void 0:B.data)==null?void 0:F.ward_mstr_id)||"",wardName:((L=(q=a==null?void 0:a.data)==null?void 0:q.data)==null?void 0:L.ward_no)||"",holdingNo:((Z=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:Z.holding_no)||"",propertyNo:((U=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:U.property_no)||"",name:((M=(W=a==null?void 0:a.data)==null?void 0:W.data)==null?void 0:M.owner_name)||"",propAddress:((Y=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:Y.prop_address)||"",mobileNo:((J=($=(H=a==null?void 0:a.data)==null?void 0:H.data)==null?void 0:$.owners[0])==null?void 0:J.mobile_no)||"",arrearDemand:((Q=(K=r==null?void 0:r.data)==null?void 0:K.data)==null?void 0:Q.arrear)||"",currentDemand:((G=(X=r==null?void 0:r.data)==null?void 0:X.data)==null?void 0:G.currentDemand)||"",interest:((P=(k=r==null?void 0:r.data)==null?void 0:k.data)==null?void 0:P.arrearMonthlyPenalty)||"",totalDemand:((ee=(D=r==null?void 0:r.data)==null?void 0:D.data)==null?void 0:ee.payableAmt)||"",changeConsTypeId:"",changeUsagesTypeId:"",latitude:"",longitude:"",document:"",remark:"",citizenComment:""},validationSchema:_e().shape({zoneId:j().required("Zone is required"),wardId:j().required("Ward is required"),latitude:j().required("Latitude is required"),longitude:j().required("Longitude is required"),document:j().required("Document is required"),remark:j().required("Remark is required")}),onSubmit:async(t,{resetForm:h})=>{var u;if(!v)return I.error("Please enable location service");if((u=c==null?void 0:c.data)!=null&&u.status&&ge()>20)return T.fire({title:"Location Service",text:"You are not in the range of 20 meters from the property location. Please go near to the property location to submit the application.",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});const d=new FormData;d.append("zoneId",t.zoneId),d.append("wardId",t.wardId),d.append("holdingNo",t.holdingNo||""),d.append("propertyNo",t.propertyNo||""),d.append("name",t.name||""),d.append("propAddress",t.propAddress||""),d.append("mobileNo",t.mobileNo||""),d.append("arrearDemand",t.arrearDemand||""),d.append("currentDemand",t.currentDemand||""),d.append("interest",t.interest||""),d.append("totalDemand",t.totalDemand||""),d.append("changeConsTypeId",t.changeConsTypeId||""),d.append("changeUsagesTypeId",t.changeUsagesTypeId||""),d.append("latitude",t.latitude),d.append("longitude",t.longitude),d.append("document",fe),d.append("remark",t.remark),d.append("citizenComment",t.citizenComment||""),T.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async l=>{var p,x,y,N,f;if(l.isConfirmed)try{const o=await Ne.mutateAsync({api:w.addVisit,data:d});(p=o==null?void 0:o.data)!=null&&p.status?(I.success((x=o==null?void 0:o.data)==null?void 0:x.message),h(),a.remove(),r.remove(),je("/amc-app/property/visiting-list",{replace:!0})):I.error((y=o==null?void 0:o.data)==null?void 0:y.message)}catch(o){I.error((f=(N=o==null?void 0:o.response)==null?void 0:N.data)==null?void 0:f.message)}}).catch(l=>{var p,x;console.log(l),I.error((x=(p=l==null?void 0:l.response)==null?void 0:p.data)==null?void 0:x.message)})}}),{values:i}=e,{data:C,isPending:Re,isError:Ze,error:Ee,isLoading:Ue}=g({api:w.getWardByZone,config:{zoneId:i==null?void 0:i.zoneId},value:[i==null?void 0:i.zoneId],options:{enabled:!!(i!=null&&i.zoneId)}}),c=g({api:w.getLatLanBySafId,config:{safId:(ne=(ae=a==null?void 0:a.data)==null?void 0:ae.data)==null?void 0:ne.saf_id},key:"safGeoLocation",value:[(de=(te=a==null?void 0:a.data)==null?void 0:te.data)==null?void 0:de.saf_id],options:{enabled:!!((ie=(re=a==null?void 0:a.data)==null?void 0:re.data)!=null&&ie.saf_id)}}),we=async t=>{var u,l;await((u=window==null?void 0:window.ReactNativeWebView)==null?void 0:u.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const h=await Be(t.target.files[0]),d=new File([h],(l=t.target.files[0])==null?void 0:l.name,{type:"image/*"});e.setFieldValue("latitude",b==null?void 0:b.latitude),e.setFieldValue("longitude",b==null?void 0:b.longitude),e.setFieldValue("document",d),Ie(d)},ge=()=>{var t,h,d,u,l,p,x,y,N,f;return((h=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:h.length)>0?he((l=(u=(d=c==null?void 0:c.safGeoLocation)==null?void 0:d.data)==null?void 0:u.data[0])==null?void 0:l.latitude,(y=(x=(p=c==null?void 0:c.safGeoLocation)==null?void 0:p.data)==null?void 0:x.data[0])==null?void 0:y.longitude,(N=e==null?void 0:e.values)==null?void 0:N.latitude,(f=e==null?void 0:e.values)==null?void 0:f.longitude):0};return n.jsx(z.Card,{children:n.jsx(z.CardBody,{color:"blue",children:n.jsxs(Ve,{formik:e,children:[n.jsx("div",{className:"p-2",children:n.jsxs("div",{className:"row",children:[n.jsxs("div",{className:"col-md-6",children:[n.jsxs(xe,{name:"zoneId",label:"Zone Name",formik:e,disabled:s,children:[n.jsx("option",{value:"",children:"Select Zone"}),qe.map(t=>n.jsx("option",{value:t.value,children:t.label},t.id))]}),n.jsxs(xe,{name:"wardId",label:"Ward Name",formik:e,disabled:s,children:[n.jsx("option",{value:"",children:"Select Ward"}),(oe=C==null?void 0:C.data)==null?void 0:oe.map(t=>n.jsx("option",{value:t.id,children:t.ward_name},t.id))]}),n.jsx(m,{name:"holdingNo",label:"Holding No",formik:e,disabled:s}),n.jsx(m,{name:"propertyNo",label:"Property No",formik:e,disabled:s}),n.jsx(m,{name:"name",label:"Name",formik:e,disabled:s}),n.jsx(m,{name:"propAddress",label:"Address",formik:e,disabled:s}),n.jsx(m,{name:"mobileNo",label:"Mobile No",formik:e,inputValidation:["mobile","number"]})]}),n.jsxs("div",{className:"col-md-6",children:[n.jsx(m,{name:"arrearDemand",label:"Arrear Demand",formik:e,inputValidation:["floatNumber"],disabled:s}),n.jsx(m,{name:"currentDemand",label:"Current Demand",inputValidation:["floatNumber"],formik:e,disabled:s}),n.jsx(m,{name:"interest",label:"Interest",formik:e,inputValidation:["floatNumber"],disabled:s}),n.jsx(m,{name:"totalDemand",label:"Total Demand",formik:e,inputValidation:["floatNumber"],disabled:s}),n.jsx(m,{name:"changeConsTypeId",label:"Change in Construction Type?",placeholder:"Construction Type",formik:e}),n.jsx(m,{name:"changeUsagesTypeId",label:"Change in Usages Type?",placeholder:"Usages Type",formik:e}),n.jsxs("div",{children:[n.jsx(m,{type:"file",label:"Visit Document",name:"document",accept:"image/*",onChange:t=>{if(!v||!ye){t.target.value=null,T.fire({title:"Location Service",text:"Please enable location service",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});return}we(t)}}),((se=e==null?void 0:e.errors)==null?void 0:se.document)&&n.jsx("span",{className:"text-red-500 text-xs",children:(ce=e==null?void 0:e.errors)==null?void 0:ce.document}),!((le=e==null?void 0:e.values)!=null&&le.latitude)&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-red-500 text-xs",children:(me=e==null?void 0:e.errors)==null?void 0:me.latitude}),n.jsx("span",{className:"text-red-500 text-xs",children:(ue=e==null?void 0:e.errors)==null?void 0:ue.longitude})]}),((pe=e==null?void 0:e.values)==null?void 0:pe.document)&&n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-xs",children:"Latitude: "+(i==null?void 0:i.latitude)}),n.jsx("span",{className:"text-xs",children:" Longitude: "+(i==null?void 0:i.longitude)})]})]}),n.jsx("div",{className:"mt-6",children:n.jsx(be,{name:"remark",label:"Remark",formik:e})}),n.jsx(be,{name:"citizenComment",label:"Citizen Comment",formik:e})]})]})}),n.jsx("div",{className:"flex justify-center",children:n.jsx(z.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function da(){const a=new URLSearchParams(window.location.search),r=g({api:w.getPropByHolding,config:{propertyId:a.get("id")},options:{enabled:!!a.get("id")}}),s=g({api:w.getDemandDetails,config:{propId:a.get("id")},options:{enabled:!!a.get("id")}});return n.jsx(ze,{title:"Visiting",children:n.jsx("div",{className:"p-2",children:n.jsx(Le,{getPropDetails:r,demandDetails:s,id:a.get("id")})})})}export{da as default};
