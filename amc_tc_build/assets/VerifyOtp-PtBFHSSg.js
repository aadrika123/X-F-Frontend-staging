import{j as l,b as L,c as B,Q as P,u as k}from"./index-JjxX5BaP.js";import{d as A}from"./router-Gz5zDwiC.js";import{u as $}from"./formik.esm--kcEIyis.js";import{c as z,a as _}from"./index.esm-R3GYZtbq.js";import{F as K}from"./FormProvider-NKN-19QA.js";import{T as ee}from"./TextField-7Hhdv6Gb.js";import{L as Q}from"./LoaderButton-TLdlWd5W.js";import"./index-iyheVW_q.js";import{u as te}from"./useCountDown-fFVZB0yz.js";var M=function(r){return typeof r=="object"&&r!==null},ae=function(r){var n=r.value,s=n===void 0?"":n,d=r.numInputs,o=d===void 0?4:d,h=r.onChange,x=r.onPaste,N=r.renderInput,D=r.shouldAutoFocus,y=D===void 0?!1:D,u=r.inputType,i=u===void 0?"text":u,O=r.renderSeparator,f=r.placeholder,g=r.containerStyle,v=r.inputStyle,S=r.skipDefaultStyles,a=S===void 0?!1:S,q=A.useState(0),m=q[0],E=q[1],I=A.useRef([]),T=function(){return s?s.toString().split(""):[]},C=i==="number"||i==="tel";A.useEffect(function(){I.current=I.current.slice(0,o)},[o]),A.useEffect(function(){var e;y&&((e=I.current[0])===null||e===void 0||e.focus())},[y]);var U=function(){if(typeof f=="string"){if(f.length===o)return f;f.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},V=function(e){var t=C?!isNaN(Number(e)):typeof e=="string";return t&&e.trim().length===1},G=function(e){var t=e.target.value;V(t)&&(F(t),j(m+1))},H=function(e){var t=e.nativeEvent,c=e.target.value;if(!V(c)){if(c.length===o){var p=c.split("").some(function(b){return!V(b)});p||(R(c.split("")),j(o-1))}t.data===null&&t.inputType==="deleteContentBackward"&&(e.preventDefault(),F(""),j(m-1)),e.target.value=""}},J=function(e){return function(t){E(t),e.target.select()}},W=function(){E(m-1)},X=function(e){var t=T();[e.code,e.key].includes("Backspace")?(e.preventDefault(),F(""),j(m-1)):e.code==="Delete"?(e.preventDefault(),F("")):e.code==="ArrowLeft"?(e.preventDefault(),j(m-1)):e.code==="ArrowRight"||e.key===t[m]?(e.preventDefault(),j(m+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},j=function(e){var t,c,p=Math.max(Math.min(o-1,e),0);I.current[p]&&((t=I.current[p])===null||t===void 0||t.focus(),(c=I.current[p])===null||c===void 0||c.select(),E(p))},F=function(e){var t=T();t[m]=e[0],R(t)},R=function(e){var t=e.join("");h(t)},Y=function(e){var t;e.preventDefault();var c=T(),p=m,b=e.clipboardData.getData("text/plain").slice(0,o-m).split("");if(!(C&&b.some(function(Z){return isNaN(Number(Z))}))){for(var w=0;w<o;++w)w>=m&&b.length>0&&(c[w]=(t=b.shift())!==null&&t!==void 0?t:"",p++);j(p),R(c)}};return A.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},M(g)&&g),className:typeof g=="string"?g:void 0,onPaste:x},Array.from({length:o},function(e,t){return t}).map(function(e){var t,c,p;return A.createElement(A.Fragment,{key:e},N({value:(t=T()[e])!==null&&t!==void 0?t:"",placeholder:(p=(c=U())===null||c===void 0?void 0:c[e])!==null&&p!==void 0?p:void 0,ref:function(b){return I.current[e]=b},onChange:G,onFocus:function(b){return J(b)(e)},onBlur:W,onKeyDown:X,onPaste:Y,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(a?{}:{width:"1em",textAlign:"center"},M(v)?v:{}),className:typeof v=="string"?v:void 0,type:i,inputMode:C?"numeric":"text",onInput:H},e),e<o-1&&(typeof O=="function"?O(e):O))}))};function ne({label:r,name:n,formik:s}){return l.jsxs("div",{className:"mb-4",children:[l.jsx("label",{htmlFor:n,className:"block text-gray-600 text-sm mb-1",children:r}),l.jsx(ae,{inputStyle:{width:"100%",height:"2.5rem",margin:"0.2rem",fontSize:"1.5rem",borderRadius:"0.375rem",border:"1px solid #E5E7EB",backgroundColor:"#F3F4F6",color:"#111827",textAlign:"center"},numInputs:6,renderSeparator:l.jsx("span",{children:"-"}),shouldAutoFocus:!0,value:(s==null?void 0:s.values[n])||"",onChange:d=>{s==null||s.setFieldValue(n,d)},renderInput:d=>l.jsx("input",{...d})}),l.jsx("span",{className:"text-red-600  text-xs",children:(s==null?void 0:s.touched[n])&&(s==null?void 0:s.errors[n])})]})}const re=z().shape({email:_().required("Email is required").email("Invalid email")});function he({next:r,data:n,setData:s}){const d=L({}),o=$({enableReinitialize:!0,initialValues:{email:n.email||""},validationSchema:re,onSubmit:async(h,{})=>{var x,N,D,y;try{const u=await d.mutateAsync({api:B.SendOtpApi,data:{email:h.email}});(x=u==null?void 0:u.data)!=null&&x.status?(r({...n,email:h==null?void 0:h.email,mobile:(N=u.data)==null?void 0:N.data},!1),P.success((D=u==null?void 0:u.data)==null?void 0:D.message)):P.error((y=u==null?void 0:u.data)==null?void 0:y.message)}catch(u){P.error(u.message)}}});return l.jsxs(K,{formik:o,children:[l.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Login with OTP"}),l.jsx(ee,{label:"Email",name:"email",type:"email",formik:o,placeholder:"Enter your email address"}),l.jsx(Q,{className:"w-full mt-4 ".concat(d.isLoading?"bg-gray-400":"bg-blue-500"),type:"submit",disabled:d.isLoading||!o.isValid,loading:d.isLoading,children:"Send OTP"})]})}const ie=z().shape({otp:_().required("OTP is required")});function ge({next:r,data:n,setData:s,prev:d}){const o=k(),h=L({}),x=L({}),{minutes:N,seconds:D,togglerTimer:y,runTimer:u}=te(.1),i=$({enableReinitialize:!0,initialValues:{email:(n==null?void 0:n.email)||"",otp:(n==null?void 0:n.otp)||"",mobile:(n==null?void 0:n.mobile)||"",type:"mobile"},validationSchema:ie,onSubmit:async(f,{})=>{var g,v,S;try{const a=await h.mutateAsync({api:B.VerifyOtpApi,data:{email:f.email,otp:f.otp,type:f.type}});((g=a==null?void 0:a.data)==null?void 0:g.status)===!0?(o==null||o.login(a),P.success((v=a==null?void 0:a.data)==null?void 0:v.message)):P.error((S=a==null?void 0:a.data)==null?void 0:S.message)}catch(a){console.log(a)}}});A.useEffect(()=>(y(),()=>{y()}),[]);const O=async()=>{var f,g,v,S;try{const a=await x.mutateAsync({api:B.SendOtpApi,data:{email:i==null?void 0:i.values.email}});(f=a==null?void 0:a.data)!=null&&f.status?(y(),s({email:i==null?void 0:i.values.email,mobile:(g=a.data)==null?void 0:g.data,otp:""}),i.setFieldValue("otp",""),P.success((v=a==null?void 0:a.data)==null?void 0:v.message)):P.error((S=a==null?void 0:a.data)==null?void 0:S.message)}catch(a){P.error(a.message)}};return l.jsxs(K,{formik:i,children:[l.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91"," ",i==null?void 0:i.values.mobile," ",l.jsx("span",{className:"text-sm text-blue-700",onClick:()=>d({email:i==null?void 0:i.values.email,otp:"",mobile:""}),children:"Edit"})]}),l.jsx(ne,{label:"Verify OTP",name:"otp",formik:i}),l.jsx(Q,{loading:h.isLoading,type:"submit",disabled:h.isLoading,children:"Verify"})," ",l.jsxs("div",{className:"text-center mt-8 text-sm",children:["Didn't receive the code?"," ",u?l.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",N,":",D]}):l.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:O,children:x.isLoading?"Resending...":x.isError?"Retry":"Resend OTP"})]})]})}export{he as S,ge as V};
