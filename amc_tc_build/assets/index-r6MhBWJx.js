import{d as ee,c as Y,p as A,j as e,Q as C,b as fe,e as we,w as _e,S as je,I as be}from"./index-yTIzcZw-.js";import{u as me,d as f,e as ue,f as ve,r as Te}from"./router-vn-0iGwJ.js";import{P as se}from"./index-ohh1QrgD.js";import{u as pe,F as Pe}from"./formik.esm-ilDmhU_v.js";import{c as ae,a as m,b as Ie,d as Se}from"./index.esm-19LW8OGO.js";import{F as Ne}from"./FormProvider-u4zJR5jt.js";import{T as H}from"./TextField-VZsMfEXn.js";import{S as Z}from"./SelectField-zgdzhjH6.js";import"./index-9INnh4Fj.js";import{r as b}from"./tailwind-umh7vczy.js";import"./reactQuery-VYMV1vFj.js";import{T as Ce}from"./TextAreaField-E1YuBQ_9.js";import{r as Le}from"./resizeImage-Qa3VomQ5.js";import{u as De}from"./useErrorFocusFields-f_sEGw1K.js";import{O as Ae}from"./OverLayLoader-661uAI7K.js";import{u as qe}from"./usePathWisePermission-THY9NG5-.js";import"./axios-lPgvryBG.js";import"./reactIcons-lANGEfNm.js";import"./headlessui-pLs_kC1m.js";import"./customInputValidation-8tSUGdUh.js";import"./module-pSsHc675.js";const re=[{label:"Yes",value:"yes"},{label:"No",value:"no"}],Re=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}],Be=[{docname:"isPhotoDoc",label:"Photograph"},{docname:"isIdProofDoc",label:"Id Proof"},{docname:"isApplicationFormDoc",label:"Application Form"},{docname:"isSaleDeedDoc",label:"Sale Deed"},{docname:"isMeasurementDoc",label:"Measurement"},{docname:"isLayoutSactionMapDoc",label:"Layout Saction Map"},{docname:"isNaOrderDoc",label:"NA Order"},{docname:"isNamunaDDoc",label:"7/12/Namuna D"},{docname:"isOthersDoc",label:"Others"}];function Oe(d){var l,M,E,R,n,D,F,$;me();const{mutateAsync:v,isLoading:o}=ee({}),T=ee({});ee({});const s=pe({enableReinitialize:!0,validationSchema:ae().shape({name:m().required("Name is required"),mobile:m().required("Mobile is required"),zoneId:m().required("Zone is required"),wardId:m().required().label("Ward"),address:m().required("Address is required"),propertyType:m().required("Property Type is required"),consumerNo:m().when("isConsumer",{is:r=>r==="yes",then:()=>m().required("Consumer No is required")}),licenseNo:m().when("isLicense",{is:r=>r==="yes",then:()=>m().required("License No is required")}),waterHarvestingDate:m().when("isWaterHarvesting",{is:r=>r==="yes",then:()=>m().required("Date is required")}),isPhotoDoc:m().matches(/yes/,"Required"),isIdProofDoc:m().matches(/yes/,"Required"),isApplicationFormDoc:m().matches(/yes/,"Required"),isSaleDeedDoc:m().matches(/yes/,"Required")}),initialValues:d==null?void 0:d.data,onSubmit:async(r,{})=>{console.log(r),d==null||d.next({...d==null?void 0:d.data,...r},!1)}}),{values:g}=s,{data:P,isPending:I,isError:q,error:L,isLoading:S}=Y({api:A.getWardByZone,config:{zoneId:g==null?void 0:g.zoneId},value:[g==null?void 0:g.zoneId],options:{enabled:!!(g!=null&&g.zoneId)}}),_=Y({api:A.masterSaf,config:{},options:{enabled:!0}}),p=async()=>{var r,N,y;try{const i=await T.mutateAsync({api:A.consumerVerify,data:{consumerNo:(r=s==null?void 0:s.values)==null?void 0:r.consumerNo}});(N=i==null?void 0:i.data)!=null&&N.status?(d==null||d.setConsumerDetails((y=i==null?void 0:i.data)==null?void 0:y.data),C.success("Consumer Verified")):C.error("Consumer not found")}catch(i){C.error(i.message)}},t=async()=>{var r,N,y;try{const i=await T.mutateAsync({api:A.tradeVerify,data:{licenseNo:(r=s==null?void 0:s.values)==null?void 0:r.licenseNo}});(N=i==null?void 0:i.data)!=null&&N.status?(d==null||d.setLicenseDetails((y=i==null?void 0:i.data)==null?void 0:y.data),C.success("License Verified")):(console.log(i==null?void 0:i.data),C.error("License not found"))}catch(i){C.error(i.message)}},h=Y({api:A.getAptByWard,config:{wardMstrId:g==null?void 0:g.wardId},value:[g==null?void 0:g.wardId],options:{enabled:((l=s.values)==null?void 0:l.propertyType)==3}});return e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"Basic Details"})}),e.jsx(b.Card,{children:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{formik:s,children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx("div",{children:e.jsx(H,{isRequiredLabel:!0,disabled:!0,label:"Property Owner Name",name:"name",type:"text",formik:s,placeholder:"Enter property owner name"})}),e.jsx(H,{isRequiredLabel:!0,label:"Mobile",name:"mobile",type:"text",formik:s,placeholder:"Enter your mobile number",onInput:r=>{r.target.value.length>10?r.target.value=r.target.value.slice(0,10):r.target.value=r.target.value.replace(/[^0-9]/g,"")}}),e.jsxs(Z,{disabled:!0,label:"Zone",name:"zoneId",formik:s,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"select"}),Re.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.id))]}),e.jsxs("div",{children:[e.jsxs(Z,{isRequiredLabel:!0,label:"Ward",formik:s,name:"wardId",disabled:!0,children:[e.jsx("option",{value:"",children:"select"}),(M=P==null?void 0:P.data)==null?void 0:M.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.ward_name},r==null?void 0:r.id))]}),e.jsx("small",{className:"text-blue-500",children:S?"Please wait...":""})]}),e.jsxs(Z,{isRequiredLabel:!0,label:"Property Type",disabled:!0,name:"propertyType",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),(n=(R=(E=_==null?void 0:_.data)==null?void 0:E.data)==null?void 0:R.property_type)==null?void 0:n.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.property_type},r==null?void 0:r.id))]}),((D=s==null?void 0:s.values)==null?void 0:D.propertyType)==3&&e.jsxs(Z,{label:"Apartment",disabled:!0,name:"apartmentId",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),($=(F=h==null?void 0:h.data)==null?void 0:F.data)==null?void 0:$.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.apartment_name},r==null?void 0:r.id))]}),e.jsx(H,{isRequiredLabel:!0,label:"Address",disabled:!0,name:"address",type:"text",formik:s,placeholder:"Enter your address"}),e.jsx(Z,{label:"Is Water Connection?",name:"isConsumer",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isConsumer==="yes"&&e.jsx(H,{isRequiredLabel:!0,onBlur:p,label:"Consumer No",name:"consumerNo",type:"text",formik:s,placeholder:"Enter your consumer number"}),e.jsx(Z,{label:"Is Trade License?",name:"isLicense",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isLicense==="yes"&&e.jsx(H,{isRequiredLabel:!0,label:"License No",onBlur:t,name:"licenseNo",type:"text",formik:s,placeholder:"Enter your license number"}),e.jsx(Z,{label:"Is Water Harvesting?",name:"isWaterHarvesting",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isWaterHarvesting==="yes"&&e.jsx(H,{isRequiredLabel:!0,label:"Water Harvesting Date",name:"waterHarvestingDate",type:"date",formik:s}),e.jsx("h1",{className:"text-xs font-semibold",children:"Please select the document you have"}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Be.map(r=>{var N,y,i,B,O;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"checkbox",name:r.docname,value:(N=s==null?void 0:s.values)==null?void 0:N[r.docname],checked:((y=s==null?void 0:s.values)==null?void 0:y[r.docname])==="yes",onChange:V=>{s.setFieldValue(r.docname,V.target.checked?"yes":"no")}}),e.jsxs("h1",{className:"text-xs font-semibold",children:[r.label,(r.docname==="isPhotoDoc"||(r==null?void 0:r.docname)=="isIdProofDoc"||(r==null?void 0:r.docname)=="isApplicationFormDoc"||(r==null?void 0:r.docname)=="isSaleDeedDoc")&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-500",children:" *"}),e.jsx("div",{className:"text-red-500 text-[10px]",children:((i=s==null?void 0:s.errors)==null?void 0:i[r.docname])&&((B=s==null?void 0:s.touched)==null?void 0:B[r.docname])&&((O=s==null?void 0:s.errors)==null?void 0:O[r.docname])})]})]})]},r.docname)})}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(b.Button,{size:"sm",type:"submit",color:"blue",loading:o,formik:s,fullWidth:!0,label:"Submit",children:"Next"})})]})})})})]})}function We(d){var I,q,L,S,_,p;f.useState(!1),f.useState({});const{data:v,consumerDetails:o,licenseDetails:T,dataFromDb:s}=d,g=()=>{d.next({...v,...v},!1)},P=()=>{d.prev({...v,...v})};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-600",children:"View Details"}),e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Basic Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=s==null?void 0:s.property_no)!=null?I:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(q=s==null?void 0:s.holding_no)!=null?q:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Zone: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(L=s==null?void 0:s.zone_name)!=null?L:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ward No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(S=s==null?void 0:s.ward_no)!=null?S:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Date of Purchase: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.land_occupation_date)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ownership Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.ownership_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.property_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.holding_type)||"-"})})]})})]}),(o==null?void 0:o.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.building_type})]})]})})})})]})]}),(o==null?void 0:o.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.building_type})]})]})})})})]})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Property Address & Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Survey No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.khata_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Plot No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.plot_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mauja Name: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.village_mauja_name)||"--"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xs font-semibold",children:["Area Of Plot (in Sq ft) :"," "]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.area_of_plot)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.prop_address)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Corresponding Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.corr_address)||"--"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Owner Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Gender"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DOB"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Relation"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Mobile No."}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Aadhar"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Pan"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Email"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Armed-Force"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Specially-Abled?"}),e.jsx("td",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(_=s==null?void 0:s.owners)==null?void 0:_.map((t,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:h+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.owner_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.owner_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.gender)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.dob)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.guardian_name)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.guardian_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.relation_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.mobile_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.aadhar_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.pan_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.email}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t!=null&&t.is_armed_force?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t!=null&&t.is_specially_abled?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},h))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Floor Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Floor Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Usage Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Occupancy Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Built up Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Carpet Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Construction Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(p=s==null?void 0:s.floors)==null?void 0:p.map((t,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:h+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.floor_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.usage_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.occupancy_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.builtup_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.carpet_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.construction_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},h+1))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs("div",{className:"flex justify-center mt-4 gap-4",children:[e.jsx(b.Button,{color:"blue-gray",onClick:P,className:"px-8",size:"sm",children:"Back"}),e.jsx(b.Button,{color:"blue",onClick:g,className:"px-8",size:"sm",children:"Next"})]})]})}function ze(d){var r,N,y,i,B,O,V,U,J,K,Q,X;fe();const[v,o]=f.useState(""),{AutoFocusErrorField:T}=De(),[s,g]=f.useState([]),P=me(),I=ee({}),[q,L]=f.useState(null),{id:S}=ue(),{pathname:_}=ve();qe((N=(r=_==null?void 0:_.split("/"))==null?void 0:r.slice(0,-1))==null?void 0:N.join("/"));const{coords:p,isGeolocationEnabled:t}=we(),h=Y({api:A.staticSafDetail,config:{applicationId:S},value:[S],options:{enabled:!!S}});Y({api:(y=_e)==null?void 0:y.workFlowInfo,config:{workflowId:(B=(i=h==null?void 0:h.data)==null?void 0:i.data)==null?void 0:B.workflow_id},value:[(V=(O=h==null?void 0:h.data)==null?void 0:O.data)==null?void 0:V.workflow_id],options:{enabled:!!((J=(U=h==null?void 0:h.data)==null?void 0:U.data)!=null&&J.workflow_id)}});const l=pe({enableReinitialize:!0,initialValues:{...d==null?void 0:d.data,geoTagged:(Q=(K=d==null?void 0:d.data)==null?void 0:K.geoTagged)==null?void 0:Q.map(a=>({...a})),comment:((X=d==null?void 0:d.data)==null?void 0:X.comment)||""},validationSchema:ae().shape({geoTagged:Ie().of(ae().shape({latitude:m().required("Latitude is required"),longitude:m().required("Longitude is required"),directionType:m().required("Direction is required"),imagePath:Se().required("Image is required")}))}),onSubmit:async a=>{je.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the survey. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(j=>{j.isConfirmed&&M(a)}).catch(j=>{var x,w;console.log(j),C.error((w=(x=j==null?void 0:j.response)==null?void 0:x.data)==null?void 0:w.message)})}}),M=async a=>{var j,x,w;try{const u=await(I==null?void 0:I.mutateAsync({api:A.surveyReassessment,data:{propId:S,propertyType:a==null?void 0:a.propertyType,apartmentId:a==null?void 0:a.apartmentId,propAddress:a==null?void 0:a.address,mobileNo:a==null?void 0:a.mobile,ownerName:a==null?void 0:a.name,ward:a==null?void 0:a.wardId,zone:a==null?void 0:a.zoneId,consumerNo:a==null?void 0:a.consumerNo,licenseNo:a==null?void 0:a.licenseNo,isWaterHarvesting:(a==null?void 0:a.isWaterHarvesting)=="yes",harvestingDate:a==null?void 0:a.waterHarvestingDate,isApplicationFormDoc:(a==null?void 0:a.isApplicationFormDoc)=="yes",isSaleDeedDoc:(a==null?void 0:a.isSaleDeedDoc)=="yes",isLayoutSactionMapDoc:(a==null?void 0:a.isLayoutSactionMapDoc)=="yes",isNaOrderDoc:(a==null?void 0:a.isNaOrderDoc)=="yes",isNamunaDDoc:(a==null?void 0:a.isNamunaDDoc)=="yes",isOthersDoc:(a==null?void 0:a.isOthersDoc)=="yes",isMeasurementDoc:(a==null?void 0:a.isMeasurementDoc)=="yes",isPhotoDoc:(a==null?void 0:a.isPhotoDoc)=="yes",isIdProofDoc:(a==null?void 0:a.isIdProofDoc)=="yes"}}));(j=u==null?void 0:u.data)!=null&&j.status&&await E(a,(w=(x=u==null?void 0:u.data)==null?void 0:x.data)==null?void 0:w.safId)}catch(u){console.log(u)}},E=async(a,j)=>{var w,u,W,z,k;const x=new FormData;x.append("safId",j),a==null||a.geoTagged.forEach((c,G)=>{x.append("latitude[".concat(G,"]"),c==null?void 0:c.latitude),x.append("longitude[".concat(G,"]"),c==null?void 0:c.longitude),x.append("directionType[".concat(G,"]"),c==null?void 0:c.directionType),x.append("imagePath[".concat(G,"]"),c==null?void 0:c.imagePath)});try{const c=await I.mutateAsync({api:A.geoTagging,data:x});(w=c==null?void 0:c.data)!=null&&w.status?(C.success((u=c==null?void 0:c.data)==null?void 0:u.message),P("/amc-app/property/saf-generated-new/".concat(j),{replace:!0})):C.error((W=c==null?void 0:c.data)==null?void 0:W.message)}catch(c){C.error((k=(z=c==null?void 0:c.response)==null?void 0:z.data)==null?void 0:k.message)}},{submitCount:R,isSubmitting:n,errors:D,isValid:F}=l,$=async(a,j,x)=>{var W,z;await((W=window==null?void 0:window.ReactNativeWebView)==null?void 0:W.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const w=await Le(a.target.files[0]),u=new File([w],(z=a.target.files[0])==null?void 0:z.name,{type:"image/*"});l.setFieldValue("geoTagged.".concat(j,".latitude"),p==null?void 0:p.latitude),l.setFieldValue("geoTagged.".concat(j,".longitude"),p==null?void 0:p.longitude),l.setFieldValue("geoTagged.".concat(j,".directionType"),x==null?void 0:x.directionType),l.setFieldValue("geoTagged.".concat(j,".imagePath"),u),L(u)};return Te.useEffect(()=>{var a;g(((a=d==null?void 0:d.data)==null?void 0:a.isWaterHarvesting)=="yes"?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[d==null?void 0:d.data]),f.useEffect(()=>{T({submitCount:R,isSubmitting:n,errors:D,isValid:F})},[D,R,n]),t||je.fire({text:"Geolocation is not enabled! Please enable to use this app",icon:"error",confirmButtonText:"Ok"}),v?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):h!=null&&h.isLoading?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[I.isLoading&&e.jsx(Ae,{}),e.jsx("div",{children:e.jsxs(Ne,{formik:l,children:[e.jsx(Pe,{name:"geoTagged",children:a=>s.map((j,x)=>{var w,u,W,z,k,c,G,te,ne,de,le,oe,ie,ce,xe,he,ge;return e.jsxs(f.Fragment,{children:[e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:j==null?void 0:j.title})}),e.jsxs(b.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(H,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(x,".latitude"),formik:l}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(H,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(x,".longitude"),formik:l})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((u=(w=l==null?void 0:l.values)==null?void 0:w.geoTagged[x])==null?void 0:u.imagePath)&&e.jsx("img",{className:"w-full h-64",loading:"lazy",src:(z=(W=l==null?void 0:l.values)==null?void 0:W.geoTagged[x])!=null&&z.imagePath?URL.createObjectURL((c=(k=l==null?void 0:l.values)==null?void 0:k.geoTagged[x])==null?void 0:c.imagePath):null,alt:(ne=(te=(G=l==null?void 0:l.values)==null?void 0:G.geoTagged[x])==null?void 0:te.imagePath)==null?void 0:ne.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:ye=>$(ye,x,j)}),e.jsx("span",{className:"text-sm text-red-500",children:(oe=(le=(de=l==null?void 0:l.errors)==null?void 0:de.geoTagged)==null?void 0:le[x])==null?void 0:oe.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((ce=(ie=l==null?void 0:l.values)==null?void 0:ie.geoTagged[x])==null?void 0:ce.imagePath)&&Math.round(((ge=(he=(xe=l==null?void 0:l.values)==null?void 0:xe.geoTagged[x])==null?void 0:he.imagePath)==null?void 0:ge.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},x)})}),e.jsx(Ce,{name:"comment",label:"Comment",formik:l}),e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-3",children:[e.jsx(b.Button,{type:"button",onClick:()=>{var a;d==null||d.prev({...d==null?void 0:d.data,geoTagged:(a=l==null?void 0:l.values)==null?void 0:a.geoTagged})},size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Back"})}),e.jsx(b.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Final Submit"})})]})]})})]})}function ds(){var l,M,E,R;const{id:d}=ue(),[v,o]=f.useState(0),[T,s]=f.useState({name:"",mobile:"",zoneId:"",wardId:"",address:"",isConsumer:"no",isLicense:"no",consumerNo:"",licenseNo:"",propertyType:"",apartmentId:"",isWaterHarvesting:"no",waterHarvestingDate:"",comment:"",isApplicationFormDoc:"no",isSaleDeedDoc:"no",isLayoutSactionMapDoc:"no",isNaOrderDoc:"no",isNamunaDDoc:"no",isOthersDoc:"no",isMeasurementDoc:"no",isPhotoDoc:"no",isIdProofDoc:"no",floors:[],geoTagged:[{latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}]}),[g,P]=f.useState({}),[I,q]=f.useState({});f.useState(""),f.useState("");const[L,S]=f.useState({}),_=n=>{console.log(n)},p=(n,D=!1)=>{if(s({...T,...n}),D){_(n);return}o(v+1)},t=n=>{s({...T,...n}),o(v-1)},h=Y({api:A.getPropByHolding,config:{propertyId:d},value:[d],options:{enabled:!!d,onSuccess:n=>{S(n==null?void 0:n.data),s(D=>{var F,$,r,N,y,i,B,O,V,U,J,K,Q,X;return{...D,name:(F=n==null?void 0:n.data)==null?void 0:F.owner_name,mobile:($=n==null?void 0:n.data)==null?void 0:$.mobile_no,zoneId:(r=n==null?void 0:n.data)==null?void 0:r.zone_mstr_id,wardId:(N=n==null?void 0:n.data)==null?void 0:N.ward_mstr_id,propertyType:(y=n==null?void 0:n.data)==null?void 0:y.prop_type_mstr_id,apartmentId:(i=n==null?void 0:n.data)==null?void 0:i.apartment_details_id,address:(B=n==null?void 0:n.data)==null?void 0:B.prop_address,isWaterHarvesting:(O=n==null?void 0:n.data)!=null&&O.is_water_harvesting?"yes":"no",waterHarvestingDate:(V=n==null?void 0:n.data)==null?void 0:V.rwh_date_from,isConsumer:((U=n==null?void 0:n.data)==null?void 0:U.water_conn_no)!=""?"yes":"no",consumerNo:(J=n==null?void 0:n.data)==null?void 0:J.water_conn_no,isLicense:(K=n==null?void 0:n.data)!=null&&K.license_no?"yes":"no",licenseNo:((Q=n==null?void 0:n.data)==null?void 0:Q.license_no)||"",floors:(X=n==null?void 0:n.data)==null?void 0:X.floors}})}}});return h.isLoading?e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-4 py-6 flex-1",children:e.jsx(be,{})})}):((M=(l=h.data)==null?void 0:l.data)==null?void 0:M.reassessment_applied)==1?e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-8 py-6 flex-1",children:e.jsx("div",{className:"text-center mt-5",children:e.jsxs("h1",{className:"text-lg font-semibold text-center mt-60 text-red-800",children:["Your Application is still in workflow.",e.jsxs("p",{className:"text-green-800 text-sm",children:["Please Track your application with",(R=(E=h.data)==null?void 0:E.data)==null?void 0:R.saf_no]})]})})})}):e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-4 py-6 flex-1",children:e.jsx("div",{children:{0:e.jsx(Oe,{next:p,data:T,setData:s,setConsumerDetails:P,setLicenseDetails:q,dataFromDb:L}),1:e.jsx(We,{next:p,prev:t,data:T,setData:s,setConsumerDetails:P,consumerDetails:g,licenseDetails:I,setLicenseDetails:q,dataFromDb:L}),2:e.jsx(ze,{next:p,prev:t,data:T,setData:s,setConsumerDetails:P,consumerDetails:g,setLicenseDetails:q,dataFromDb:L})}[v]})})})}export{ds as default};
