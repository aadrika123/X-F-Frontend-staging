import{e as Sa,d as la,Q as j,S as wa,f as I,c as _,p as Pa,j as d}from"./index-2FNpzmLv.js";import{P as ka}from"./index-AymLhCAD.js";import{u as Ra,d as qa}from"./router-5yjtezO8.js";import{u as Va}from"./formik.esm-BnzrXcQN.js";import{c as La,a as h}from"./index.esm-uHa2PMRf.js";import{F as Ba}from"./FormProvider-wrdcxLW7.js";import{T as r}from"./TextField-Gtha7sjA.js";import{S as y}from"./SelectField-IZiMIn1_.js";import{T as Ia}from"./TextAreaField-ri1oNZH8.js";import"./index-iFVn5AxS.js";import{r as Ea}from"./resizeImage-Q7xN4Qye.js";import{r as w}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";const Za=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}],Ma=[{id:1,label:"Metered"},{id:3,label:"Fixed"}];function Wa({getConsumerDtl:i,getDemandDtl:x,id:o}){var T,A,F,S,l,P,k,R,q,V,L,B,E,Z,M,W,O,G,Y,$,H,J,K,Q,U,X,g,v,C,u,D,aa,ia,da,ea,na,oa,ca,ra,pa,ta,ma,ba,xa,Na,ha,ja;const _a=Ra(),{coords:N,isGeolocationEnabled:z,isGeolocationAvailable:za}=Sa(),Ta=la({}),[Oa,Aa]=qa.useState(null),e=Va({enableReinitialize:!0,initialValues:{consumerId:o||0,zoneName:((A=(T=i==null?void 0:i.data)==null?void 0:T.data)==null?void 0:A.zone_name)||"",zoneId:((S=(F=i==null?void 0:i.data)==null?void 0:F.data)==null?void 0:S.zone_mstr_id)||"",wardId:((P=(l=i==null?void 0:i.data)==null?void 0:l.data)==null?void 0:P.ward_mstr_id)||"",wardName:((R=(k=i==null?void 0:i.data)==null?void 0:k.data)==null?void 0:R.ward_number)||"",holdingNo:((V=(q=i==null?void 0:i.data)==null?void 0:q.data)==null?void 0:V.holding_no)||"",propertyNo:((B=(L=i==null?void 0:i.data)==null?void 0:L.data)==null?void 0:B.folio_no)||"",connectionType:((Z=(E=i==null?void 0:i.data)==null?void 0:E.data)==null?void 0:Z.connection_type)||"",ConsumerNo:((W=(M=i==null?void 0:i.data)==null?void 0:M.data)==null?void 0:W.consumer_no)||"",applicantName:((G=(O=i==null?void 0:i.data)==null?void 0:O.data)==null?void 0:G.applicant_name)||"",category:(($=(Y=i==null?void 0:i.data)==null?void 0:Y.data)==null?void 0:$.category)||"",meterNo:((J=(H=i==null?void 0:i.data)==null?void 0:H.data)==null?void 0:J.meter_no)||"",mobileNo:((Q=(K=i==null?void 0:i.data)==null?void 0:K.data)==null?void 0:Q.mobile_no)||"",meterReading:((X=(U=i==null?void 0:i.data)==null?void 0:U.data)==null?void 0:X.meter_reading)||"",address:((v=(g=i==null?void 0:i.data)==null?void 0:g.data)==null?void 0:v.address)||"",demandAmount:((u=(C=x==null?void 0:x.data)==null?void 0:C.data)==null?void 0:u.totalSumDemand)||"",latitude:"",longitude:"",document:"",remarks:"",citizenComment:""},validationSchema:La().shape({zoneId:h().required("Zone is required"),wardId:h().required("Ward is required"),latitude:h().required("Latitude is required"),longitude:h().required("Longitude is required"),document:h().required("Document is required"),remarks:h().required("Remark is required")}),onSubmit:async(a,{resetForm:s})=>{if(!z)return j.error("Please enable location service");const n=new FormData;n.append("consumerId",a==null?void 0:a.consumerId),n.append("zoneId",a==null?void 0:a.zoneId),n.append("wardId",a==null?void 0:a.wardId),n.append("holdingNo",a==null?void 0:a.holdingNo),n.append("propertyNo",a==null?void 0:a.propertyNo),n.append("applicantName",a==null?void 0:a.applicantName),n.append("mobileNo",a==null?void 0:a.mobileNo),n.append("address",a==null?void 0:a.address),n.append("connectionType",a==null?void 0:a.connectionType),n.append("connectionTypeName",(a==null?void 0:a.connectionType)==1?"Metered":"Fixed"),n.append("ConsumerNo",a==null?void 0:a.ConsumerNo),n.append("category",a==null?void 0:a.category),n.append("meterNo",a==null?void 0:a.meterNo),n.append("meterReading",a==null?void 0:a.meterReading),n.append("latitude",a==null?void 0:a.latitude),n.append("longitude",a==null?void 0:a.longitude),n.append("document",a==null?void 0:a.document),n.append("remarks",a==null?void 0:a.remarks),n.append("citizenComment",a==null?void 0:a.citizenComment),n.append("demandAmount",a==null?void 0:a.demandAmount),wa.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async t=>{var m,b,fa,sa,ya;if(t.isConfirmed)try{const c=await Ta.mutateAsync({api:I.addWaterTcVisit,data:n});(m=c==null?void 0:c.data)!=null&&m.status?(j.success((b=c==null?void 0:c.data)==null?void 0:b.message),_a("/amc-app/water/list-tc-visit",{replace:!0}),s(),x.remove(),i.remove()):j.error((fa=c==null?void 0:c.data)==null?void 0:fa.message)}catch(c){j.error((ya=(sa=c==null?void 0:c.response)==null?void 0:sa.data)==null?void 0:ya.message)}}).catch(t=>{var m,b;console.log(t),j.error((b=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:b.message)})}}),{values:p}=e,{data:f,isPending:Ga,isError:Ya,error:$a,isLoading:Ha}=_({api:Pa.getWardByZone,config:{zoneId:p==null?void 0:p.zoneId},value:[p==null?void 0:p.zoneId],options:{enabled:!!(p!=null&&p.zoneId)}}),Fa=async a=>{var t,m,b;if(!((t=a.target)!=null&&t.files[0]))return;await((m=window==null?void 0:window.ReactNativeWebView)==null?void 0:m.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const s=await Ea(a.target.files[0]),n=new File([s],(b=a.target.files[0])==null?void 0:b.name,{type:"image/*"});e.setFieldValue("latitude",N==null?void 0:N.latitude),e.setFieldValue("longitude",N==null?void 0:N.longitude),e.setFieldValue("document",n),Aa(n)};return d.jsx(w.Card,{children:d.jsx(w.CardBody,{color:"blue",children:d.jsxs(Ba,{formik:e,children:[d.jsx("div",{className:"p-2",children:d.jsxs("div",{className:"row",children:[d.jsxs("div",{className:"col-md-6",children:[d.jsxs(y,{name:"zoneId",label:"Zone Name",formik:e,disabled:o,children:[d.jsx("option",{value:"",children:"Select Zone"}),Za.map(a=>d.jsx("option",{value:a.value,children:a.label},a.id))]}),d.jsxs(y,{name:"wardId",label:"Ward Name",formik:e,disabled:o,children:[d.jsx("option",{value:"",children:"Select Ward"}),(D=f==null?void 0:f.data)==null?void 0:D.map(a=>d.jsx("option",{value:a.id,children:a.ward_name},a.id))]}),d.jsx(r,{name:"holdingNo",label:"Holding No",formik:e,disabled:o&&((ia=(aa=i==null?void 0:i.data)==null?void 0:aa.data)==null?void 0:ia.holding_no)}),d.jsx(r,{name:"propertyNo",label:"Property No",formik:e,disabled:o&&((ea=(da=i==null?void 0:i.data)==null?void 0:da.data)==null?void 0:ea.folio_no)}),d.jsx(r,{name:"applicantName",label:"Name",formik:e,disabled:o&&((oa=(na=i==null?void 0:i.data)==null?void 0:na.data)==null?void 0:oa.applicant_name)}),d.jsx(r,{name:"mobileNo",label:"Mobile No",formik:e}),d.jsx(r,{name:"address",label:"Address",formik:e,disabled:o&&((ra=(ca=i==null?void 0:i.data)==null?void 0:ca.data)==null?void 0:ra.address),inputValidation:["mobile"]})]}),d.jsx("div",{className:"col-md-6",children:d.jsxs(y,{name:"connectionType",label:"Connection Type",formik:e,disabled:o,children:[d.jsx("option",{value:"",children:"Connection Type"}),Ma.map(a=>d.jsx("option",{value:a.id,children:a.label},a.id))]})}),d.jsxs("div",{className:"col-md-6",children:[d.jsx(r,{name:"ConsumerNo",label:"Consumer No",formik:e,disabled:o&&((ta=(pa=i==null?void 0:i.data)==null?void 0:pa.data)==null?void 0:ta.consumer_no)}),d.jsx(r,{name:"category",label:"Category",formik:e,disabled:o&&((ba=(ma=i==null?void 0:i.data)==null?void 0:ma.data)==null?void 0:ba.category)}),d.jsx(r,{name:"meterNo",label:"Meter No",formik:e,disabled:o&&((Na=(xa=i==null?void 0:i.data)==null?void 0:xa.data)==null?void 0:Na.meter_no)}),d.jsx(r,{name:"meterReading",label:"Meter Reading",formik:e,disabled:o&&((ja=(ha=i==null?void 0:i.data)==null?void 0:ha.data)==null?void 0:ja.meter_reading)}),d.jsx(r,{name:"demandAmount",label:"Demand Amount",formik:e,disabled:o}),d.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[d.jsxs("div",{className:"col-span-2",children:[d.jsx(r,{label:"Document",type:"file",name:"document",accept:"image/*",onChange:a=>{if(!z||!za){a.target.value=null,wa.fire({title:"Location Service",text:"Please enable location service",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});return}Fa(a)}}),e.errors.document&&e.touched.document?d.jsx("small",{className:"text-red-500 -mt-2",children:e.errors.document}):null]}),d.jsx("div",{children:d.jsx(r,{name:"latitude",label:"Latitude",formik:e,disabled:!0})}),d.jsx("div",{children:d.jsx(r,{name:"longitude",label:"Longitude",formik:e,disabled:!0})})]}),d.jsx(Ia,{name:"remarks",label:"Remarks",formik:e}),d.jsx(Ia,{name:"citizenComment",label:"Citizen Comment",formik:e})]})]})}),d.jsx("div",{className:"flex justify-center",children:d.jsx(w.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function ri(){const i=new URLSearchParams(window.location.search),x=_({api:I.waterGetDetails,key:"waterVisitDetail",config:{applicationId:i.get("id")},options:{enabled:!!i.get("id")}}),o=_({api:I.waterListDemand,key:"waterVisitListDemand",config:{ConsumerId:i.get("id")},options:{enabled:!!i.get("id")}});return d.jsx(ka,{title:"Water Visiting",children:d.jsx("div",{className:"p-2",children:d.jsx(Wa,{getConsumerDtl:x,getDemandDtl:o,id:i.get("id")})})})}export{ri as default};
