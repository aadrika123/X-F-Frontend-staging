import{e as le,d as pe,Q as m,p as h,c as I,j as e}from"./index-4cGi8UK6.js";import{P as ue}from"./index-MN12Mwbo.js";import{u as xe,d as he}from"./router-5yjtezO8.js";import{u as be}from"./formik.esm-BnzrXcQN.js";import{c as je,a as l}from"./index.esm-uHa2PMRf.js";import{F as Ne}from"./FormProvider-y2WI37H4.js";import{T as o}from"./TextField-ZjV3PrFE.js";import{S as re}from"./SelectField-yaQnRuep.js";import{T as te}from"./TextAreaField-InKpg16T.js";import"./index-iFVn5AxS.js";import{r as ye}from"./resizeImage-nEogeHoA.js";import{r as y}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";const Ie=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function we({getPropDetails:n,demandDetails:i}){var f,z,g,C,A,T,v,F,_,q,S,V,L,Z,R,E,U,W,B,M,G,O,H,$,J,K,Q,X,Y,k,P,D,ee,ae;const b=xe(),{coords:c,isGeolocationEnabled:w,isGeolocationAvailable:ie}=le(),oe=pe({}),[se,ce]=he.useState(null),a=be({enableReinitialize:!0,initialValues:{zoneName:((z=(f=n==null?void 0:n.data)==null?void 0:f.data)==null?void 0:z.zone_name)||"",zoneId:((C=(g=n==null?void 0:n.data)==null?void 0:g.data)==null?void 0:C.zone_mstr_id)||"",wardId:((T=(A=n==null?void 0:n.data)==null?void 0:A.data)==null?void 0:T.ward_mstr_id)||"",wardName:((F=(v=n==null?void 0:n.data)==null?void 0:v.data)==null?void 0:F.ward_no)||"",holdingNo:((q=(_=n==null?void 0:n.data)==null?void 0:_.data)==null?void 0:q.holding_no)||"",propertyNo:((V=(S=n==null?void 0:n.data)==null?void 0:S.data)==null?void 0:V.property_no)||"",name:((Z=(L=n==null?void 0:n.data)==null?void 0:L.data)==null?void 0:Z.owner_name)||"",propAddress:((E=(R=n==null?void 0:n.data)==null?void 0:R.data)==null?void 0:E.prop_address)||"",mobileNo:((B=(W=(U=n==null?void 0:n.data)==null?void 0:U.data)==null?void 0:W.owners[0])==null?void 0:B.mobile_no)||"",arrearDemand:((G=(M=i==null?void 0:i.data)==null?void 0:M.data)==null?void 0:G.arrear)||"",currentDemand:((H=(O=i==null?void 0:i.data)==null?void 0:O.data)==null?void 0:H.currentDemand)||"",interest:((J=($=i==null?void 0:i.data)==null?void 0:$.data)==null?void 0:J.arrearMonthlyPenalty)||"",totalDemand:((Q=(K=i==null?void 0:i.data)==null?void 0:K.data)==null?void 0:Q.payableAmt)||"",changeConsTypeId:"",changeUsagesTypeId:"",latitude:"",longitude:"",visitDoc:"",remark:"",citizenComment:""},validationSchema:je().shape({zoneId:l().required("Zone is required"),wardId:l().required("Ward is required"),latitude:l().required("Latitude is required"),longitude:l().required("Longitude is required"),visitDoc:l().required("Visit Document is required"),remark:l().required("Remark is required")}),onSubmit:async(d,{resetForm:N})=>{var p,u,x,ne,de;if(!w)return m.error("Please enable location service");try{const r=new FormData;r.append("zoneId",d.zoneId),r.append("wardId",d.wardId),r.append("holdingNo",d.holdingNo||""),r.append("propertyNo",d.propertyNo||""),r.append("name",d.name||""),r.append("propAddress",d.propAddress||""),r.append("mobileNo",d.mobileNo||""),r.append("arrearDemand",d.arrearDemand||""),r.append("currentDemand",d.currentDemand||""),r.append("interest",d.interest||""),r.append("totalDemand",d.totalDemand||""),r.append("changeConsTypeId",d.changeConsTypeId||""),r.append("changeUsagesTypeId",d.changeUsagesTypeId||""),r.append("latitude",d.latitude),r.append("longitude",d.longitude),r.append("document",se),r.append("remark",d.remark),r.append("citizenComment",d.citizenComment||"");const s=await oe.mutateAsync({api:h.addVisit,data:r});(p=s==null?void 0:s.data)!=null&&p.status?(m.success((u=s==null?void 0:s.data)==null?void 0:u.message),N(),b("/amc-app/property/visiting-list",{replace:!0})):m.error((x=s==null?void 0:s.data)==null?void 0:x.message)}catch(r){m.error((de=(ne=r==null?void 0:r.response)==null?void 0:ne.data)==null?void 0:de.message)}}}),{values:t}=a,{data:j,isPending:fe,isError:ze,error:ge,isLoading:Ce}=I({api:h.getWardByZone,config:{zoneId:t==null?void 0:t.zoneId},value:[t==null?void 0:t.zoneId],options:{enabled:!!(t!=null&&t.zoneId)}}),me=async d=>{var u,x;if(!w)return m.error("Please enable location service");if(!ie)return m.error("Location not available");await((u=window==null?void 0:window.ReactNativeWebView)==null?void 0:u.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const N=await ye(d.target.files[0]),p=new File([N],(x=d.target.files[0])==null?void 0:x.name,{type:"image/*"});a.setFieldValue("latitude",c==null?void 0:c.latitude),a.setFieldValue("longitude",c==null?void 0:c.longitude),a.setFieldValue("visitDoc",p),ce(p)};return e.jsx(y.Card,{children:e.jsx(y.CardBody,{color:"blue",children:e.jsxs(Ne,{formik:a,children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs(re,{name:"zoneId",label:"Zone Name",formik:a,children:[e.jsx("option",{value:"",children:"Select Zone"}),Ie.map(d=>e.jsx("option",{value:d.value,children:d.label},d.id))]}),e.jsxs(re,{name:"wardId",label:"Ward Name",formik:a,children:[e.jsx("option",{value:"",children:"Select Ward"}),(X=j==null?void 0:j.data)==null?void 0:X.map(d=>e.jsx("option",{value:d.id,children:d.ward_name},d.id))]}),e.jsx(o,{name:"holdingNo",label:"Holding No",formik:a}),e.jsx(o,{name:"propertyNo",label:"Property No",formik:a}),e.jsx(o,{name:"name",label:"Name",formik:a}),e.jsx(o,{name:"propAddress",label:"Address",formik:a}),e.jsx(o,{name:"mobileNo",label:"Mobile No",formik:a})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(o,{name:"arrearDemand",label:"Arrear Demand",formik:a}),e.jsx(o,{name:"currentDemand",label:"Current Demand",formik:a}),e.jsx(o,{name:"interest",label:"Interest",formik:a}),e.jsx(o,{name:"totalDemand",label:"Total Demand",formik:a}),e.jsx(o,{name:"changeConsTypeId",label:"Construction Type",formik:a}),e.jsx(o,{name:"changeUsagesTypeId",label:"Usages Type",formik:a}),e.jsxs("div",{children:[e.jsx(o,{type:"file",label:"Visit Document",capture:"environment",name:"document",accept:"image/*",id:"document",onChange:d=>me(d)}),((Y=a==null?void 0:a.errors)==null?void 0:Y.visitDoc)&&e.jsx("span",{className:"text-red-500 text-xs",children:(k=a==null?void 0:a.errors)==null?void 0:k.visitDoc}),((P=a==null?void 0:a.errors)==null?void 0:P.latitude)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-500 text-xs",children:(D=a==null?void 0:a.errors)==null?void 0:D.latitude}),e.jsx("span",{className:"text-red-500 text-xs",children:(ee=a==null?void 0:a.errors)==null?void 0:ee.longitude})]}),((ae=a==null?void 0:a.values)==null?void 0:ae.visitDoc)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",children:"Latitude: "+(t==null?void 0:t.latitude)}),e.jsx("span",{className:"text-xs",children:" Longitude: "+(t==null?void 0:t.longitude)})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(te,{name:"remark",label:"Remark",formik:a})}),e.jsx(te,{name:"citizenComment",label:"Citizen Comment",formik:a})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function Oe(){const n=new URLSearchParams(window.location.search),i=I({api:h.getPropByHolding,config:{propertyId:n.get("id")},options:{enabled:!!n.get("id")}}),b=I({api:h.getDemandDetails,config:{propId:n.get("id")},options:{enabled:!!n.get("id")}});return e.jsx(ue,{title:"Visiting",children:e.jsx("div",{className:"p-2",children:e.jsx(we,{getPropDetails:i,demandDetails:b})})})}export{Oe as default};
