import{S as ce,Q as P,m as D,c as de,j as e,d as ie,I as xe}from"./index-YXbhhyGq.js";import{e as re,u as le}from"./router-5yjtezO8.js";import{r as p,P as ne}from"./tailwind-6U-kYQAu.js";import{O as me}from"./OverLayLoader-meEGTogN.js";import{F as he}from"./FormProvider-CX0sjiOX.js";import{T as x}from"./TextField-dryogryT.js";import{S as se}from"./SelectField-hx_DELGt.js";import{u as pe}from"./formik.esm-BnzrXcQN.js";import"./index-iFVn5AxS.js";import{c as ue,a as l}from"./index.esm-uHa2PMRf.js";import{P as je}from"./index-Vewm7L_t.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./module-8ed8l8zs.js";import"./customInputValidation-jhKsg103.js";oe.propTypes={shopDetails:ne.any,paymentMutation:ne.any};function oe({shopDetails:d,paymentMutation:F}){var b,N,y,f,t,j,g,w,v,E,S,Y,B,I,A,H,$,U,Q,T,O,L,R,_;const{id:i}=re(),c=le(),n=pe({initialValues:{toFYear:"",paymentMode:"",bankName:"",chequeNo:"",ddNo:"",branchName:"",photo:"",chequeDdDate:""},validationSchema:ue({toFYear:l().required("Required"),paymentMode:l().required("Required"),bankName:l().when(["paymentMode"],{is:a=>["CHEQUE","DD"].includes(a),then:()=>l().required("Cheque/DD No is required")}),chequeNo:l().when(["paymentMode"],{is:a=>a==="CHEQUE",then:()=>l().required("Cheque No is required")}),ddNo:l().when(["paymentMode"],{is:a=>a==="DD",then:()=>l().required("DD No is required")}),branchName:l().when(["paymentMode"],{is:a=>["CHEQUE","DD"].includes(a),then:()=>l().required("Branch Name is required")}),chequeDdDate:l().when(["paymentMode"],{is:a=>["CHEQUE","DD"].includes(a),then:()=>l().required("Cheque/DD Date is required")}),photo:l().when(["paymentMode"],{is:a=>["CHEQUE","DD"].includes(a),then:()=>l().required("Photo is required")})}),onSubmit:async a=>{var m,u;ce.fire({title:"Are you sure?",text:"You want to proceed with payment of Rs."+((u=(m=r==null?void 0:r.data)==null?void 0:m.data)==null?void 0:u.amount),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async h=>{h.isConfirmed&&await M(a)}).catch(h=>{var q,C;P.error((C=(q=h==null?void 0:h.response)==null?void 0:q.data)==null?void 0:C.message)})}}),M=async a=>{var h,q,C,k,z,V,G,J,K,W,X,Z,ee,ae,te;let m="",u=null;try{if(a.paymentMode==="CASH"&&(m=(h=D)==null?void 0:h.shopPaymentCash,u={shopId:i,toFYear:a.toFYear,paymentMode:a.paymentMode}),a.paymentMode==="CHEQUE"||a.paymentMode==="DD"){m=(q=D)==null?void 0:q.payNowCheckOrDD;const o=new FormData;o.append("shopId",i),o.append("toFYear",a.toFYear),o.append("paymentMode",a.paymentMode),o.append("bankName",a.bankName),o.append("branchName",a.branchName),o.append("chequeDdDate",a.chequeDdDate),o.append("photo",a.photo),a.paymentMode==="CHEQUE"&&o.append("chequeNo",a.chequeNo),a.paymentMode==="DD"&&o.append("ddNo",a.ddNo),u=o}a.paymentMode==="ONLINE"&&(m=(C=D)==null?void 0:C.shopPaymentOnline,u={shopId:i,uptoFYear:a.toFYear,frontFailUrl:"".concat(window.location.origin,"/amc-app/adv-municipal-rental/shop-details/").concat(i),frontSuccessUrl:"".concat(window.location.origin,"/amc-app/adv-municipal-rental/shop-details/").concat(i)});const s=await F.mutateAsync({api:m,data:u});if(console.log(s==null?void 0:s.data),((k=s==null?void 0:s.data)==null?void 0:k.status)===!0){if(((V=(z=s==null?void 0:s.data)==null?void 0:z.data)==null?void 0:V.url)!=null){window.location.href=(J=(G=s==null?void 0:s.data)==null?void 0:G.data)==null?void 0:J.url;return}P.success((K=s==null?void 0:s.data)==null?void 0:K.message);const o=a.paymentMode=="CASH"?(X=(W=s==null?void 0:s.data)==null?void 0:W.data)==null?void 0:X.tranId:(ae=(ee=(Z=s==null?void 0:s.data)==null?void 0:Z.data)==null?void 0:ee.details)==null?void 0:ae.id;c("/amc-app/adv-municipal-rental/payment-receipt?tran-id=".concat(o),{replace:!0})}else P.error((te=s==null?void 0:s.data)==null?void 0:te.message)}catch(s){console.log(s)}},r=de({api:(b=D)==null?void 0:b.calculateShopRate,config:{shopId:i,toFYear:(N=n==null?void 0:n.values)==null?void 0:N.toFYear},key:"calculateDemand",value:[n.values.toFYear],options:{enabled:!!((y=n==null?void 0:n.values)!=null&&y.toFYear)}});return e.jsx(p.Card,{children:e.jsxs(p.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-1",children:e.jsx("h1",{className:"text-sm font-semibold",children:"# Payment"})}),e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Total Demand"}),e.jsxs("h1",{className:"text-xs text-blue-500",children:[" ₹ ",(t=(f=d==null?void 0:d.data)==null?void 0:f.data)==null?void 0:t.total]})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Paid Amount"}),e.jsxs("h1",{className:"text-xs text-green-500",children:["₹ ",(g=(j=d==null?void 0:d.data)==null?void 0:j.data)==null?void 0:g.totalPaid]})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Pending Amount"}),e.jsxs("h1",{className:"text-xs text-red-500",children:["₹ ",(v=(w=d==null?void 0:d.data)==null?void 0:w.data)==null?void 0:v.pendingAmount]})]})]}),((S=(E=d==null?void 0:d.data)==null?void 0:E.data)==null?void 0:S.pendingAmount)>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(he,{formik:n,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(se,{label:"To Financial Year",name:"toFYear",formik:n,children:[e.jsx("option",{value:"",children:"Select Financial Year"}),(I=(B=(Y=d==null?void 0:d.data)==null?void 0:Y.data)==null?void 0:B.fYear)==null?void 0:I.map((a,m)=>e.jsx("option",{value:a==null?void 0:a.id,children:a==null?void 0:a.financialYear},m+1))]}),e.jsxs(se,{label:"Payment Mode",name:"paymentMode",formik:n,children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),e.jsx("option",{value:"CASH",children:"Cash"}),e.jsx("option",{value:"CHEQUE",children:"Cheque"}),e.jsx("option",{value:"DD",children:"DD"}),e.jsx("option",{value:"ONLINE",children:"Online"})]})]}),((A=n==null?void 0:n.values)==null?void 0:A.paymentMode)==="CHEQUE"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{label:"Bank Name",name:"bankName",formik:n}),e.jsx(x,{label:"Cheque No",name:"chequeNo",formik:n}),e.jsx(x,{label:"Branch Name",name:"branchName",formik:n}),e.jsx(x,{label:"Cheque Date",name:"chequeDdDate",min:new Date().toISOString().split("T")[0],type:"date",formik:n}),e.jsx("div",{className:"col-span-2",children:e.jsx(x,{name:"photo",type:"file",onChange:a=>n.setFieldValue("photo",a.target.files[0])})})]}),((H=n==null?void 0:n.values)==null?void 0:H.paymentMode)==="DD"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{label:"Bank Name",name:"bankName",formik:n}),e.jsx(x,{label:"DD No",name:"ddNo",formik:n}),e.jsx(x,{label:"Branch Name",name:"branchName",formik:n}),e.jsx(x,{label:"DD Date",name:"chequeDdDate",type:"date",formik:n,min:new Date().toISOString().split("T")[0]}),e.jsx("div",{className:"col-span-2",children:e.jsx(x,{label:"Photo",name:"photo",onChange:a=>n.setFieldValue("photo",a.target.files[0]),type:"file"})})]}),e.jsx("div",{className:"my-4 border-b-2"}),((U=($=r==null?void 0:r.data)==null?void 0:$.data)==null?void 0:U.amount)>0&&e.jsx("div",{className:"flex justify-center items-center mb-1",children:e.jsxs("h1",{className:"text-base font-semibold text-gray-900",children:["Payable Amount :"," ",e.jsxs("span",{className:"text-red-500",children:["₹ ",(T=(Q=r==null?void 0:r.data)==null?void 0:Q.data)==null?void 0:T.amount]})]})}),e.jsxs("div",{className:"flex justify-center items-center gap-3",children:[e.jsx(p.Button,{color:"blue",size:"sm",className:"text-xs w-full",onClick:()=>{var a;return c("/amc-app/adv-municipal-rental/demand-receipt?id=".concat(i,"&year=").concat((a=n==null?void 0:n.values)==null?void 0:a.toFYear,"&get-demand=all"))},children:e.jsx("small",{children:"Demand Receipt"})}),e.jsxs(p.Button,{color:"green",size:"sm",className:"text-xs w-full",type:"submit",children:[e.jsx("small",{children:"Pay Now "})," ",((L=(O=r==null?void 0:r.data)==null?void 0:O.data)==null?void 0:L.amount)>0&&e.jsxs(e.Fragment,{children:["₹",(_=(R=r==null?void 0:r.data)==null?void 0:R.data)==null?void 0:_.amount]})]})]})]})]})]})})}function Ie(){var n,M,r,b,N,y,f;const{id:d}=re(),F=ie({}),i=le(),c=de({api:(n=D)==null?void 0:n.shopDetailById,config:{id:d},options:{enabled:!!d}});return c.isLoading?e.jsx(xe,{}):e.jsxs(je,{title:"Shop Details",children:[F.isLoading&&e.jsx(me,{}),e.jsxs("div",{className:"p-4",children:[e.jsx(p.Card,{children:e.jsxs(p.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"# Basic Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"flex flex-col",children:(b=(r=(M=c==null?void 0:c.data)==null?void 0:M.data)==null?void 0:r.shopDetails)==null?void 0:b.map((t,j)=>e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:t==null?void 0:t.displayString}),e.jsx("h1",{className:"text-xs",children:t==null?void 0:t.value})]},j+1))})]})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx(oe,{shopDetails:c,paymentMutation:F}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"# Demand Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg rounded-xl",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-2 text-center border border-slate-300",children:"Financial Year"}),e.jsx("th",{className:"text-xs font-semibold p-2 text-center border border-slate-300",children:"Generated Demand"}),e.jsx("th",{className:"text-xs font-semibold p-2 text-center border border-slate-300",children:"Payment Date"}),e.jsx("th",{className:"text-xs font-semibold p-2 text-center border border-slate-300",children:"payment Status"})]})}),e.jsx("tbody",{children:(f=(y=(N=c==null?void 0:c.data)==null?void 0:N.data)==null?void 0:y.demands)==null?void 0:f.map((t,j)=>{var g,w,v;return e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-2 text-center border border-slate-300",children:(g=t==null?void 0:t.financial_year)!=null?g:"---"}),e.jsxs("td",{className:"text-xs p-2 text-center border border-slate-300",children:[e.jsx("span",{children:"₹"}),(w=t==null?void 0:t.amount)!=null?w:0]}),e.jsx("td",{className:"text-xs p-2 text-center border border-slate-300",children:(v=t==null?void 0:t.payment_date)!=null?v:"---"}),e.jsx("td",{className:"text-xs p-2 text-center border border-slate-300",children:(t==null?void 0:t.payment_status)==0&&(t==null?void 0:t.amount)!=null&&e.jsx(p.Button,{color:"blue",variant:"outlined",size:"sm",className:"py-1.5 px-4",onClick:()=>{i("/amc-app/adv-municipal-rental/demand-receipt?id=".concat(d,"&year=").concat(t==null?void 0:t.financial_year))},children:e.jsx("small",{children:"Demand"})})||(t==null?void 0:t.payment_status)==1&&(t==null?void 0:t.amount)!=null&&e.jsx(p.Button,{variant:"outlined",color:"green",size:"sm",className:"py-1.5 px-4",onClick:()=>{i("/amc-app/adv-municipal-rental/payment-receipt?tran-id=".concat(t==null?void 0:t.tran_id))},children:e.jsx("small",{children:"Receipt"})})||(t==null?void 0:t.payment_status)==0&&(t==null?void 0:t.amount)==null&&e.jsx("h1",{className:"text-xs text-red-500",children:"Not Generated"})})]},j+1)})})]})})]})]})}export{Ie as default};
