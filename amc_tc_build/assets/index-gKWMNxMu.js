import{u as ce,b as ge,g as me,a as ue,p as k,Q as y,j as e}from"./index-rvbWXsAs.js";import{R as p,u as pe,h as he,f as xe,r as je,e as x}from"./react-HXRlOr-l.js";import{c as ee,e as ye,a as b,f as be}from"./index.esm-yBrOrWJe.js";import{u as fe,F as Ne}from"./formik.esm-BYe_KACy.js";import{F as Te}from"./FormProvider-KXcKKeLM.js";import{T as ae}from"./TextField-7yddcJ1G.js";import"./index-mWJwE1Yp.js";import{P as ve}from"./index-ydPQ-Vjj.js";import{r as Fe}from"./resizeImage-jKDw1KZT.js";import{u as Pe}from"./useErrorFocusFields-o-KJnuHP.js";import{O as we}from"./OverLayLoader-VNf_HxNe.js";import{u as $e}from"./usePathWisePermission-16jkxiF3.js";import"./module-P9sElsZx.js";function He(){var w,$,L,R,I,A,E,_,S,C,q,V,G,M,O,W;ce();const[te,f]=p.useState(""),{AutoFocusErrorField:se}=Pe(),[h,ie]=p.useState([]),N=pe(),T=ge({}),[Le,re]=p.useState(null),{id:m}=he(),{pathname:j}=xe();$e(($=(w=j==null?void 0:j.split("/"))==null?void 0:w.slice(0,-1))==null?void 0:$.join("/"));const{coords:u,isGeolocationEnabled:oe}=me(),s=ue({api:k.staticSafDetail,config:{applicationId:m},value:[m],options:{enabled:!!m,onSuccess:r=>{var o,i;(o=r==null?void 0:r.data)!=null&&o.status?(f(!1),(i=r==null?void 0:r.data)!=null&&i.is_geo_tagged&&N("/amc-app/property/measurement-sheet/".concat(m),{replace:!0})):f(!0)}}}),a=fe({enableReinitialize:!0,initialValues:{geoTagged:h==null?void 0:h.map(r=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}))},validationSchema:ee().shape({geoTagged:ye().of(ee().shape({latitude:b().required("Latitude is required"),longitude:b().required("Longitude is required"),directionType:b().required("Direction is required"),imagePath:be().required("Image is required")}))}),onSubmit:async r=>{var i,c,d,n,l;const o=new FormData;o.append("safId",m),r==null||r.geoTagged.forEach((t,g)=>{o.append("latitude[".concat(g,"]"),t==null?void 0:t.latitude),o.append("longitude[".concat(g,"]"),t==null?void 0:t.longitude),o.append("directionType[".concat(g,"]"),t==null?void 0:t.directionType),o.append("imagePath[".concat(g,"]"),t==null?void 0:t.imagePath)});try{const t=await T.mutateAsync({api:k.geoTagging,data:o});(i=t==null?void 0:t.data)!=null&&i.status?(y.success((c=t==null?void 0:t.data)==null?void 0:c.message),N("/amc-app/property/measurement-sheet/".concat(m),{replace:!0})):y.error((d=t==null?void 0:t.data)==null?void 0:d.message)}catch(t){y.error((l=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:l.message)}}}),{submitCount:v,isSubmitting:F,errors:P,isValid:de}=a,ne=async(r,o,i)=>{var n,l;await((n=window==null?void 0:window.ReactNativeWebView)==null?void 0:n.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const c=await Fe(r.target.files[0]),d=new File([c],(l=r.target.files[0])==null?void 0:l.name,{type:"image/*"});a.setFieldValue("geoTagged.".concat(o,".latitude"),u==null?void 0:u.latitude),a.setFieldValue("geoTagged.".concat(o,".longitude"),u==null?void 0:u.longitude),a.setFieldValue("geoTagged.".concat(o,".directionType"),i==null?void 0:i.directionType),a.setFieldValue("geoTagged.".concat(o,".imagePath"),d),re(d)};return je.useEffect(()=>{var r,o,i;(r=s==null?void 0:s.data)!=null&&r.data&&ie((i=(o=s==null?void 0:s.data)==null?void 0:o.data)!=null&&i.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(R=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:R.saf_no]),p.useEffect(()=>{se({submitCount:v,isSubmitting:F,errors:P,isValid:de})},[P,v,F]),oe||alert("Geolocation is not enabled! Please enable to use this app"),te?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):e.jsxs(ve,{title:"Geo Tagging",children:[T.isLoading&&e.jsx(we,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(x.Card,{className:"w-full",children:e.jsxs(x.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(A=(I=s==null?void 0:s.data)==null?void 0:I.data)==null?void 0:A.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(_=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:_.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(C=(S=s==null?void 0:s.data)==null?void 0:S.data)==null?void 0:C.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(V=(q=s==null?void 0:s.data)==null?void 0:q.data)==null?void 0:V.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:(W=(O=(M=(G=s==null?void 0:s.data)==null?void 0:G.data)==null?void 0:M.owners)==null?void 0:O.map(r=>r==null?void 0:r.mobile_no))==null?void 0:W.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(Te,{formik:a,children:[e.jsx(Ne,{name:"geoTagged",children:r=>h.map((o,i)=>{var c,d,n,l,t,g,H,z,B,U,J,K,Q,X,Y,Z,D;return e.jsxs(p.Fragment,{children:[e.jsxs(x.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:o==null?void 0:o.title})}),e.jsxs(x.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(ae,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".latitude"),formik:a}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(ae,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".longitude"),formik:a})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((d=(c=a==null?void 0:a.values)==null?void 0:c.geoTagged[i])==null?void 0:d.imagePath)&&e.jsx("img",{className:"w-full h-64",src:(l=(n=a==null?void 0:a.values)==null?void 0:n.geoTagged[i])!=null&&l.imagePath?URL.createObjectURL((g=(t=a==null?void 0:a.values)==null?void 0:t.geoTagged[i])==null?void 0:g.imagePath):null,alt:(B=(z=(H=a==null?void 0:a.values)==null?void 0:H.geoTagged[i])==null?void 0:z.imagePath)==null?void 0:B.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:le=>ne(le,i,o)}),e.jsx("span",{className:"text-sm text-red-500",children:(K=(J=(U=a==null?void 0:a.errors)==null?void 0:U.geoTagged)==null?void 0:J[i])==null?void 0:K.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((X=(Q=a==null?void 0:a.values)==null?void 0:Q.geoTagged[i])==null?void 0:X.imagePath)&&Math.round(((D=(Z=(Y=a==null?void 0:a.values)==null?void 0:Y.geoTagged[i])==null?void 0:Z.imagePath)==null?void 0:D.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},i)})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-lg text-white text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out",children:"Save & Next"})})]})]})]})}export{He as default};
