import{d as De,c as we,f as C,S as Me,Q as N,j as e}from"./index-N6pSFXKN.js";import{u as Ie,e as Ee,r as Pe}from"./router-vn-0iGwJ.js";import{r as P}from"./tailwind-umh7vczy.js";import{u as Ae}from"./formik.esm-ilDmhU_v.js";import"./moment-UBOc2Xni.js";import{F as Oe}from"./FormProvider-htHaRUb8.js";import{T as i}from"./TextField-qt08UeJb.js";import{S as Fe}from"./SelectField-iN1UnMnE.js";import{T as Re}from"./TextAreaField-dlKNNq3z.js";import"./index-9INnh4Fj.js";import{c as Se,a as j,d as Ce,f as qe}from"./index.esm-AAGMkvXl.js";import{P as Be}from"./index-K9dyFfkH.js";import{O as _e}from"./OverLayLoader-KyBIxRmb.js";import{r as $e}from"./resizeImage-6pRbk8q3.js";import{u as Le}from"./usePathWisePermission-KBS6_JeU.js";import{U as Ue}from"./useSaveLocation-jqACjoi_.js";import{u as We}from"./useLocationRadius-cwU6sdLK.js";import"./reactQuery-VYMV1vFj.js";import"./axios-lPgvryBG.js";import"./reactIcons-lANGEfNm.js";import"./headlessui-pLs_kC1m.js";import"./customInputValidation-jhKsg103.js";import"./module-wYrZBkjv.js";const Ye=()=>({handlePayment:async(s,p,b)=>{var I,T,w,u,l,F,E,A,m,o,n,O;console.log((T=(I=s==null?void 0:s.data)==null?void 0:I.data)==null?void 0:T.hash,"dsfghfjgkhlj");var M={features:{enableAbortResponse:!0,enableExpressPay:!0,enableInstrumentDeRegistration:!0,enableMerTxnDetails:!0,enableNewWindowFlow:!0},consumerData:{deviceId:"WEBSH2",token:"".concat((u=(w=s==null?void 0:s.data)==null?void 0:w.data)==null?void 0:u.hash),responseHandler:c=>{typeof c<"u"&&typeof c.paymentMethod<"u"&&typeof c.paymentMethod.paymentTransaction<"u"&&typeof c.paymentMethod.paymentTransaction.statusCode<"u"&&c.paymentMethod.paymentTransaction.statusCode=="0300"?(p(c),window.localStorage.setItem("successBlock",JSON.stringify(c)),console.log(c,"sucees")):typeof c<"u"&&typeof c.paymentMethod<"u"&&typeof c.paymentMethod.paymentTransaction<"u"&&typeof c.paymentMethod.paymentTransaction.statusCode<"u"&&c.paymentMethod.paymentTransaction.statusCode=="0398"?console.log(c,"initiated"):(b(),console.log(c,"error block"))},paymentMode:"all",merchantLogoUrl:"https://www.paynimo.com/CompanyDocs/company-logo-vertical.png",merchantId:(F=(l=s==null?void 0:s.data)==null?void 0:l.data)==null?void 0:F.marchantId,currency:"INR",consumerId:"".concat((A=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:A.consumerId),txnId:"".concat((o=(m=s==null?void 0:s.data)==null?void 0:m.data)==null?void 0:o.txnid),items:[{itemId:"first",amount:"".concat((O=(n=s==null?void 0:s.data)==null?void 0:n.data)==null?void 0:O.amount),comAmt:"0"}],customStyle:{PRIMARY_COLOR_CODE:"#45beaa",SECONDARY_COLOR_CODE:"#FFFFFF",BUTTON_COLOR_CODE_1:"#2d8c8c",BUTTON_COLOR_CODE_2:"#FFFFFF"}}};$.pnCheckout(M),M.features.enableNewWindowFlow&&pnCheckoutShared.openNewWindow()}}),Ve=Ye;function ja(){var R,S,B,_,L,U,W,Y,V,z,H,J,G,Q,K,X,Z,v,k,ee,ae,te,ne,de,se,re;const{radiusInMeters:d,distanceToTargetEast:s,distanceToTargetNorth:p,distanceToTargetSouth:b,distanceToTargetWest:M}=We(),{handlePayment:I}=Ve(),T=Ie(),{saveLocation:w}=Ue(),u=De({}),{id:l}=Ee(),{result:F}=Le("/amc-app/water/water-payment"),E=async a=>{try{const r=await u.mutateAsync({api:C.paymentResponseDemand,data:{txnid:a==null?void 0:a.merchantTransactionIdentifier,applycationType:"Demand Collection"}});r.data.status?T("/amc-app/water/water-payment-receipt/".concat(l)):console.log("Error While paying Online Payment ",r.data.message)}catch(r){console.log("Online payment not done successfully",r)}},A=()=>{console.log("Error:fasdasdas "),T("/amc-app/water/water-payment/".concat(l))},m=we({api:C.waterGetDetails,config:{applicationId:l},value:[l],options:{enabled:!!l}}),o=we({api:C.waterListDemand,config:{ConsumerId:l},value:[l],options:{enabled:!!l}}),n=Ae({enableReinitialize:!0,initialValues:{consumerId:l,demandFrom:"",demandUpto:"",amount:"",paymentMode:"",remarks:"",paymentType:"isFullPayment",chequeDate:"",bankName:"",branchName:"",chequeNo:"",document:""},validationSchema:Se().shape({paymentMode:j().required("Required"),chequeDate:j().when("paymentMode",{is:a=>a=="Cheque"||a=="DD"||a=="NEFT",then:()=>j().required("Required")}),bankName:j().when("paymentMode",{is:a=>a=="Cheque"||a=="DD"||a=="NEFT",then:()=>j().required("Required")}),branchName:j().when("paymentMode",{is:a=>a=="Cheque"||a=="DD"||a=="NEFT",then:()=>j().required("Required")}),chequeNo:j().when("paymentMode",{is:a=>a=="Cheque"||a=="DD"||a=="NEFT",then:()=>j().required("Required")}),document:Ce().when("paymentMode",{is:a=>a=="Cheque"||a=="DD"||a=="NEFT",then:()=>Ce().required("Required")}),paymentType:j().required("Required"),amount:qe().when("paymentType",{is:a=>a=="isPartPayment",then:()=>qe().required("Required")}),remarks:j().required("Required")}),onSubmit:async a=>{Me.fire({title:"Are you sure?",text:"You want to proceed with payment of Rs."+f(),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(r=>{r.isConfirmed&&O(a)}).catch(r=>{var x,h;N.error((h=(x=r==null?void 0:r.response)==null?void 0:x.data)==null?void 0:h.message)})}}),O=async a=>{var x,h,y,g,q,D,oe,ce,me,ie,le,he,xe,pe,ye,je,Ne,be,ue,fe,ge,Te;if(f()<=0){N.error("Please enter valid amount");return}const r={consumerId:a==null?void 0:a.consumerId,demandFrom:a==null?void 0:a.demandFrom,demandUpto:a==null?void 0:a.demandUpto,amount:(a==null?void 0:a.paymentType)=="isPartPayment"?f():"",paymentMode:a==null?void 0:a.paymentMode,remarks:a==null?void 0:a.remarks,paymentType:a==null?void 0:a.paymentType,deviceType:"android",chequeDate:a==null?void 0:a.chequeDate,bankName:a==null?void 0:a.bankName,branchName:a==null?void 0:a.branchName,chequeNo:a==null?void 0:a.chequeNo,document:a==null?void 0:a.document};if((a==null?void 0:a.paymentMode)=="Cheque"||(a==null?void 0:a.paymentMode)=="DD"||(a==null?void 0:a.paymentMode)=="NEFT"){try{const t=await u.mutateAsync({api:(x=C)==null?void 0:x.waterDemandPayment,data:r});(h=t==null?void 0:t.data)!=null&&h.status?(w({actionType:"successWaterPayment",refId:(g=(y=t==null?void 0:t.data)==null?void 0:y.data)==null?void 0:g.transactionId,moduleId:2}),T("/amc-app/water/water-payment-response?response=".concat((D=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:D.TransactionNo,"&id=").concat((ce=(oe=t==null?void 0:t.data)==null?void 0:oe.data)==null?void 0:ce.transactionId),{replace:!0}),N.success((me=t==null?void 0:t.data)==null?void 0:me.message)):(w({actionType:"failedWaterPayment",refId:l,moduleId:2}),N.error((ie=t==null?void 0:t.data)==null?void 0:ie.message))}catch(t){N.error(t==null?void 0:t.message)}return}if((a==null?void 0:a.paymentMode)=="Cash"){try{const t=await u.mutateAsync({api:(le=C)==null?void 0:le.waterDemandPayment,data:r});(he=t==null?void 0:t.data)!=null&&he.status?(w({actionType:"successWaterPayment",refId:(pe=(xe=t==null?void 0:t.data)==null?void 0:xe.data)==null?void 0:pe.transactionId,moduleId:2}),T("/amc-app/water/water-payment-response?response=".concat((je=(ye=t==null?void 0:t.data)==null?void 0:ye.data)==null?void 0:je.TransactionNo,"&id=").concat((be=(Ne=t==null?void 0:t.data)==null?void 0:Ne.data)==null?void 0:be.transactionId),{replace:!0}),N.success((ue=t==null?void 0:t.data)==null?void 0:ue.message)):(w({actionType:"failedWaterPayment",refId:l,moduleId:2}),N.error((fe=t==null?void 0:t.data)==null?void 0:fe.message))}catch(t){N.error(t==null?void 0:t.message)}return}if((a==null?void 0:a.paymentMode)=="Online"){try{const t=await u.mutateAsync({api:C.initiatePayment,data:{consumerId:l,applycationType:"Demand Collection",paymentMode:a==null?void 0:a.paymentMode,paymentType:a==null?void 0:a.paymentType,...(a==null?void 0:a.paymentType)=="isPartPayment"&&{amount:f()}}});((ge=t==null?void 0:t.data)==null?void 0:ge.status)==!0?await I(t,E,A):N.error((Te=t==null?void 0:t.data)==null?void 0:Te.message)}catch(t){N.error(t==null?void 0:t.message)}return}};Pe.useEffect(()=>{var a,r,x,h,y,g;(((a=n==null?void 0:n.values)==null?void 0:a.paymentMode)=="Cash"||((r=n==null?void 0:n.values)==null?void 0:r.paymentMode)=="Online"||((x=n==null?void 0:n.values)==null?void 0:x.paymentMode)=="NEFT"||((h=n==null?void 0:n.values)==null?void 0:h.paymentMode)=="DD"||((y=n==null?void 0:n.values)==null?void 0:y.paymentMode)=="Cheque"||((g=n==null?void 0:n.values)==null?void 0:g.paymentMode)=="Online")&&(n.setFieldValue("chequeDate",""),n.setFieldValue("bankName",""),n.setFieldValue("branchName",""),n.setFieldValue("chequeNo",""),n.setFieldValue("document",""))},[(R=n==null?void 0:n.values)==null?void 0:R.paymentMode]);const c=async a=>{var h,y;const r=await $e(a.target.files[0]),x=new File([r],(y=(h=a==null?void 0:a.target)==null?void 0:h.files[0])==null?void 0:y.name,{type:"image/*"});n.setFieldValue("document",x)},f=()=>{var r,x,h,y,g,q,D;let a=0;return((r=n.values)==null?void 0:r.paymentType)=="isFullPayment"&&(a=parseFloat((h=(x=o==null?void 0:o.data)==null?void 0:x.data)==null?void 0:h.totalSumDemand)-parseFloat((g=(y=o==null?void 0:o.data)==null?void 0:y.data)==null?void 0:g.remainAdvance)),((q=n.values)==null?void 0:q.paymentType)=="isPartPayment"&&(a=parseFloat((D=n.values)==null?void 0:D.amount)),a};return Pe.useEffect(()=>{f()},[(S=n.values)==null?void 0:S.amount]),e.jsxs(Be,{title:"Pay Now",children:[u.isLoading&&e.jsx(_e,{}),e.jsxs("div",{className:"p-4",children:[e.jsx(P.Card,{children:e.jsxs(P.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-base font-semibold",children:"# Basic Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Applicant name:"}),e.jsx("h1",{className:"text-sm",children:(_=(B=m==null?void 0:m.data)==null?void 0:B.data)==null?void 0:_.applicant_name})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Property No:"}),e.jsx("h1",{className:"text-sm",children:(U=(L=m==null?void 0:m.data)==null?void 0:L.data)==null?void 0:U.folio_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Consumer No:"}),e.jsx("h1",{className:"text-sm",children:(Y=(W=m==null?void 0:m.data)==null?void 0:W.data)==null?void 0:Y.consumer_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-sm",children:((z=(V=m==null?void 0:m.data)==null?void 0:V.data)==null?void 0:z.reading_date)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Address:"}),e.jsx("h1",{className:"text-sm w-36 truncate",children:((J=(H=m==null?void 0:m.data)==null?void 0:H.data)==null?void 0:J.address)||"--"})]})]})]})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs(P.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Demand List"})}),e.jsx(P.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"# Sno."}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND FROM"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND UPTO"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND AMOUNT"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PENALTY"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"CONNECTION TYPE"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PAYABLE AMOUNT"})]})}),e.jsx("tbody",{children:(K=(Q=(G=o==null?void 0:o.data)==null?void 0:G.data)==null?void 0:Q.consumerDemands)==null?void 0:K.map((a,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:r+1}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.demand_from}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.demand_upto}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.balance_amount}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.penalty}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.connection_type}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a==null?void 0:a.due_balance_amount})]},r))})]})})})]}),e.jsx("div",{className:"my-3 border-b-2"}),s>=d&&M>=d&&b>=d&&p>=d?e.jsx(Oe,{formik:n,children:e.jsxs(P.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Payment Details"})}),e.jsxs(P.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsxs(Fe,{label:"Payment Mode",name:"paymentMode",formik:n,children:[e.jsx("option",{value:"",children:"Select Payment Mode"}),e.jsx("option",{value:"Cash",children:"Cash"}),e.jsx("option",{value:"Cheque",children:"Cheque"}),e.jsx("option",{value:"DD",children:"DD"}),e.jsx("option",{value:"Online",children:"Online"})]})}),e.jsx("div",{children:e.jsxs(Fe,{label:"Payment Type",name:"paymentType",formik:n,children:[e.jsx("option",{value:"",children:"Select Payment Type"}),e.jsx("option",{value:"isFullPayment",children:"Full Payment"}),(F==null?void 0:F.read)&&e.jsx("option",{value:"isPartPayment",children:"Part Payment"})]})})]}),((X=n.values)==null?void 0:X.paymentType)=="isPartPayment"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{label:"Amount",name:"amount",type:"number",formik:n,onInput:((Z=n.values)==null?void 0:Z.paymentType)==="isPartPayment"?a=>{a.target.value=Math.max(0,parseInt(a.target.value)).toString().slice(0,10)}:null})})]}),((v=n.values)==null?void 0:v.paymentMode)=="Cheque"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3 border-b-2"}),e.jsx(ze,{formik:n,handleSelectImg:c})]}),((k=n.values)==null?void 0:k.paymentMode)=="DD"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3 border-b-2"}),e.jsx(He,{formik:n,handleSelectImg:c})]}),((ee=n.values)==null?void 0:ee.paymentMode)=="NEFT"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-3 border-b-2"}),e.jsx(Je,{formik:n,handleSelectImg:c})]}),e.jsx("div",{className:"col-span-2 mt-3",children:e.jsx(Re,{label:"Remarks",name:"remarks",type:"text",formik:n})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 ",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold",children:"Total Demand:"})}),e.jsx("div",{className:"text-end",children:e.jsxs("h1",{className:"text-sm",children:["₹"," ",((te=(ae=o==null?void 0:o.data)==null?void 0:ae.data)==null?void 0:te.totalSumDemand)||0]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-red-600",children:"Penalty:"})}),e.jsx("div",{className:"text-end",children:e.jsxs("h1",{className:"text-sm text-red-600",children:["₹"," ",(de=(ne=o==null?void 0:o.data)==null?void 0:ne.data)==null?void 0:de.totalPenalty]})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-sm font-semibold",children:["Advance:",e.jsx("small",{className:"text-[10px] text-blue-800",children:"( If your have any advance amount, it will be deducted from total demand amount. )"})]})}),e.jsx("div",{className:"text-end",children:e.jsxs("h1",{className:"text-sm",children:["₹"," ",(re=(se=o==null?void 0:o.data)==null?void 0:se.data)==null?void 0:re.remainAdvance]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-green-600",children:"Total Pay Amount:"}),e.jsx("small",{className:"text-[10px] text-blue-800",children:"( Total Demand - Advance Amount)"})]}),e.jsx("div",{className:"text-end",children:e.jsxs("h1",{className:"text-sm text-green-600 font-semibold",children:["₹"," ",f()>0?f():0]})})]}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(P.Button,{type:"submit",color:"blue",size:"sm",loading:u.isLoading,children:["Pay Now ",f()>0&&"₹ ".concat(f())]})})]})]})}):e.jsx("div",{className:"flex justify-center items-center  py-2",children:e.jsx("h1",{className:"text-sm font-semibold text-center text-red-800",children:"You are inside the 50 meter radius of zonal office, you can't make payment"})})]})]})}const ze=({formik:d,handleSelectImg:s})=>{var p;return e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(i,{label:"Cheque No",name:"chequeNo",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Cheque Date",name:"chequeDate",type:"date",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Bank Name",name:"bankName",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Branch Name",name:"branchName",type:"text",formik:d})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{label:"Upload Cheque Image",name:"document",type:"file",onChange:b=>s(b)}),e.jsx("small",{className:"text-red-500",children:(p=d==null?void 0:d.errors)==null?void 0:p.document})]})]})},He=({formik:d,handleSelectImg:s})=>{var p;return e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(i,{label:"DD No",name:"chequeNo",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"DD Date",name:"chequeDate",type:"date",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Bank Name",name:"bankName",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Branch Name",name:"branchName",type:"text",formik:d})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{label:"Upload DD Image",name:"document",type:"file",onChange:b=>s(b)}),e.jsx("small",{className:"text-red-500 -mt-6",children:(p=d==null?void 0:d.errors)==null?void 0:p.document})]})]})},Je=({formik:d,handleSelectImg:s})=>{var p;return e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(i,{label:"NEFT No",name:"chequeNo",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"NEFT Date",name:"chequeDate",type:"date",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Bank Name",name:"bankName",type:"text",formik:d})}),e.jsx("div",{children:e.jsx(i,{label:"Branch Name",name:"branchName",type:"text",formik:d})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(i,{label:"Upload NEFT Image",name:"document",type:"file",onChange:b=>s(b)}),e.jsx("small",{className:"text-red-500 -mt-6",children:(p=d==null?void 0:d.errors)==null?void 0:p.document})]})]})};export{ja as default};
