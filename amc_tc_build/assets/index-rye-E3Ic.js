import{e as je,d as Ne,Q as f,S as C,p as w,b as I,j as a}from"./index-UcSlE0BD.js";import{P as ye}from"./index-OUYZNpwz.js";import{e as fe,d as we}from"./router-vSHQYlWC.js";import{u as Ie}from"./formik.esm-feHG9Gj_.js";import{c as Te,a as g}from"./index.esm-YegZWto1.js";import{F as Ce}from"./FormProvider-bCXam-jg.js";import{T as m}from"./TextField-i6b9Ij09.js";import{S as se}from"./SelectField-xWHEZ5Q0.js";import{T as ce}from"./TextAreaField-wZm5ZkYW.js";import"./TranslateField-Ix0vkbtj.js";import{r as ze}from"./resizeImage-kjmVxggV.js";import{r as z}from"./tailwind-nPCoKmcy.js";import{u as ve}from"./useLocationRadius-ySO25LDP.js";import"./reactQuery-xwoMMF6K.js";import"./axios-lPgvryBG.js";import"./reactIcons-jqXmw8S_.js";import"./headlessui-kWR29u24.js";import"./customInputValidation-jhKsg103.js";const Ae=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function Se({getPropDetails:n,demandDetails:i,id:o}){var A,S,V,B,F,_,q,R,Z,E,U,W,L,M,O,Y,H,$,J,K,Q,X,k,G,P,D,ee,ae,ne,te,de,re,ie,oe;const{calculateDistance:le}=ve(),me=fe(),{coords:b,isGeolocationEnabled:v,isGeolocationAvailable:ue}=je(),pe=Ne({}),[xe,be]=we.useState(null),e=Ie({enableReinitialize:!0,initialValues:{zoneName:((S=(A=n==null?void 0:n.data)==null?void 0:A.data)==null?void 0:S.zone_name)||"",zoneId:((B=(V=n==null?void 0:n.data)==null?void 0:V.data)==null?void 0:B.zone_mstr_id)||"",wardId:((_=(F=n==null?void 0:n.data)==null?void 0:F.data)==null?void 0:_.ward_mstr_id)||"",wardName:((R=(q=n==null?void 0:n.data)==null?void 0:q.data)==null?void 0:R.ward_no)||"",holdingNo:((E=(Z=n==null?void 0:n.data)==null?void 0:Z.data)==null?void 0:E.holding_no)||"",propertyNo:((W=(U=n==null?void 0:n.data)==null?void 0:U.data)==null?void 0:W.property_no)||"",name:((M=(L=n==null?void 0:n.data)==null?void 0:L.data)==null?void 0:M.owner_name)||"",propAddress:((Y=(O=n==null?void 0:n.data)==null?void 0:O.data)==null?void 0:Y.prop_address)||"",mobileNo:((J=($=(H=n==null?void 0:n.data)==null?void 0:H.data)==null?void 0:$.owners[0])==null?void 0:J.mobile_no)||"",arrearDemand:((Q=(K=i==null?void 0:i.data)==null?void 0:K.data)==null?void 0:Q.arrear)||"",currentDemand:((k=(X=i==null?void 0:i.data)==null?void 0:X.data)==null?void 0:k.currentDemand)||"",interest:((P=(G=i==null?void 0:i.data)==null?void 0:G.data)==null?void 0:P.arrearMonthlyPenalty)||"",totalDemand:((ee=(D=i==null?void 0:i.data)==null?void 0:D.data)==null?void 0:ee.payableAmt)||"",changeConsTypeId:"",changeUsagesTypeId:"",latitude:"",longitude:"",document:"",remark:"",citizenComment:""},validationSchema:Te().shape({zoneId:g().required("Zone is required"),wardId:g().required("Ward is required"),latitude:g().required("Latitude is required"),longitude:g().required("Longitude is required"),document:g().required("Document is required"),remark:g().required("Remark is required")}),onSubmit:async(t,{resetForm:h})=>{var u;if(!v)return f.error("Please enable location service");if((u=c==null?void 0:c.data)!=null&&u.status&&ge()>20)return C.fire({title:"Location Service",text:"You are not in the range of 20 meters from the property location. Please go near to the property location to submit the application.",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});const d=new FormData;d.append("zoneId",t.zoneId),d.append("wardId",t.wardId),d.append("holdingNo",t.holdingNo||""),d.append("propertyNo",t.propertyNo||""),d.append("name",t.name||""),d.append("propAddress",t.propAddress||""),d.append("mobileNo",t.mobileNo||""),d.append("arrearDemand",t.arrearDemand||""),d.append("currentDemand",t.currentDemand||""),d.append("interest",t.interest||""),d.append("totalDemand",t.totalDemand||""),d.append("changeConsTypeId",t.changeConsTypeId||""),d.append("changeUsagesTypeId",t.changeUsagesTypeId||""),d.append("latitude",t.latitude),d.append("longitude",t.longitude),d.append("document",xe),d.append("remark",t.remark),d.append("citizenComment",t.citizenComment||""),C.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async l=>{var p,x,j,N,y;if(l.isConfirmed)try{const r=await pe.mutateAsync({api:w.addVisit,data:d});(p=r==null?void 0:r.data)!=null&&p.status?(f.success((x=r==null?void 0:r.data)==null?void 0:x.message),h(),n.remove(),i.remove(),me("/amc-app/property/visiting-list",{replace:!0})):f.error((j=r==null?void 0:r.data)==null?void 0:j.message)}catch(r){f.error((y=(N=r==null?void 0:r.response)==null?void 0:N.data)==null?void 0:y.message)}}).catch(l=>{var p,x;console.log(l),f.error((x=(p=l==null?void 0:l.response)==null?void 0:p.data)==null?void 0:x.message)})}}),{values:s}=e,{data:T,isPending:Ve,isError:Be,error:Fe,isLoading:_e}=I({api:w.getWardByZone,config:{zoneId:s==null?void 0:s.zoneId},value:[s==null?void 0:s.zoneId],options:{enabled:!!(s!=null&&s.zoneId)}}),c=I({api:w.verificationComp,config:{verificationId:o},key:"safGeoLocation",value:[o],options:{enabled:!!o}}),he=async t=>{var u,l;await((u=window==null?void 0:window.ReactNativeWebView)==null?void 0:u.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const h=await ze(t.target.files[0]),d=new File([h],(l=t.target.files[0])==null?void 0:l.name,{type:"image/*"});e.setFieldValue("latitude",b==null?void 0:b.latitude),e.setFieldValue("longitude",b==null?void 0:b.longitude),e.setFieldValue("document",d),be(d)},ge=()=>{var t,h,d,u,l,p,x,j,N,y,r;return((d=(h=(t=c==null?void 0:c.data)==null?void 0:t.data)==null?void 0:h.geoTagging)==null?void 0:d.length)>0?le((p=(l=(u=c==null?void 0:c.data)==null?void 0:u.data)==null?void 0:l.geoTagging[0])==null?void 0:p.latitude,(N=(j=(x=c==null?void 0:c.data)==null?void 0:x.data)==null?void 0:j.geoTagging[0])==null?void 0:N.longitude,(y=e==null?void 0:e.values)==null?void 0:y.latitude,(r=e==null?void 0:e.values)==null?void 0:r.longitude):0};return a.jsx(z.Card,{children:a.jsx(z.CardBody,{color:"blue",children:a.jsxs(Ce,{formik:e,children:[a.jsx("div",{className:"p-2",children:a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-md-6",children:[a.jsxs(se,{name:"zoneId",label:"Zone Name",formik:e,disabled:o,children:[a.jsx("option",{value:"",children:"Select Zone"}),Ae.map(t=>a.jsx("option",{value:t.value,children:t.label},t.id))]}),a.jsxs(se,{name:"wardId",label:"Ward Name",formik:e,disabled:o,children:[a.jsx("option",{value:"",children:"Select Ward"}),(ae=T==null?void 0:T.data)==null?void 0:ae.map(t=>a.jsx("option",{value:t.id,children:t.ward_name},t.id))]}),a.jsx(m,{name:"holdingNo",label:"Holding No",formik:e,disabled:o}),a.jsx(m,{name:"propertyNo",label:"Property No",formik:e,disabled:o}),a.jsx(m,{name:"name",label:"Name",formik:e,disabled:o}),a.jsx(m,{name:"propAddress",label:"Address",formik:e,disabled:o}),a.jsx(m,{name:"mobileNo",label:"Mobile No",formik:e,inputValidation:["mobile","number"]})]}),a.jsxs("div",{className:"col-md-6",children:[a.jsx(m,{name:"arrearDemand",label:"Arrear Demand",formik:e,inputValidation:["floatNumber"],disabled:o}),a.jsx(m,{name:"currentDemand",label:"Current Demand",inputValidation:["floatNumber"],formik:e,disabled:o}),a.jsx(m,{name:"interest",label:"Interest",formik:e,inputValidation:["floatNumber"],disabled:o}),a.jsx(m,{name:"totalDemand",label:"Total Demand",formik:e,inputValidation:["floatNumber"],disabled:o}),a.jsx(m,{name:"changeConsTypeId",label:"Change in Construction Type?",placeholder:"Construction Type",formik:e}),a.jsx(m,{name:"changeUsagesTypeId",label:"Change in Usages Type?",placeholder:"Usages Type",formik:e}),a.jsxs("div",{children:[a.jsx(m,{type:"file",label:"Visit Document",name:"document",accept:"image/*",onChange:t=>{if(!v||!ue){t.target.value=null,C.fire({title:"Location Service",text:"Please enable location service",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});return}he(t)}}),((ne=e==null?void 0:e.errors)==null?void 0:ne.document)&&a.jsx("span",{className:"text-red-500 text-xs",children:(te=e==null?void 0:e.errors)==null?void 0:te.document}),!((de=e==null?void 0:e.values)!=null&&de.latitude)&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-red-500 text-xs",children:(re=e==null?void 0:e.errors)==null?void 0:re.latitude}),a.jsx("span",{className:"text-red-500 text-xs",children:(ie=e==null?void 0:e.errors)==null?void 0:ie.longitude})]}),((oe=e==null?void 0:e.values)==null?void 0:oe.document)&&a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-xs",children:"Latitude: "+(s==null?void 0:s.latitude)}),a.jsx("span",{className:"text-xs",children:" Longitude: "+(s==null?void 0:s.longitude)})]})]}),a.jsx("div",{className:"mt-6",children:a.jsx(ce,{name:"remark",label:"Remark",formik:e})}),a.jsx(ce,{name:"citizenComment",label:"Citizen Comment",formik:e})]})]})}),a.jsx("div",{className:"flex justify-center",children:a.jsx(z.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function De(){const n=new URLSearchParams(window.location.search),i=I({api:w.getPropByHolding,config:{propertyId:n.get("id")},options:{enabled:!!n.get("id")}}),o=I({api:w.getDemandDetails,config:{propId:n.get("id")},options:{enabled:!!n.get("id")}});return a.jsx(ye,{title:"Visiting",children:a.jsx("div",{className:"p-2",children:a.jsx(Se,{getPropDetails:i,demandDetails:o,id:n.get("id")})})})}export{De as default};
