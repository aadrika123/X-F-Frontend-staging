import{d as J,c as Y,p as L,j as e,Q as S,b as Ne,e as ye,w as fe,S as ge,I as we}from"./index-bjBLJJSs.js";import{u as be,d as y,e as je,f as _e,r as ve}from"./router-vn-0iGwJ.js";import{P as Te}from"./index-2Q5eF_5p.js";import{u as me,F as Pe}from"./formik.esm-ilDmhU_v.js";import{c as Q,a as j,b as Ie,d as Se}from"./index.esm-19LW8OGO.js";import{F as ue}from"./FormProvider-jZObsn_L.js";import{T as H}from"./TextField-h6PpXaq4.js";import{S as Z}from"./SelectField-6-dWzXjq.js";import"./index-9INnh4Fj.js";import{r as b}from"./tailwind-umh7vczy.js";import"./reactQuery-VYMV1vFj.js";import{T as Ce}from"./TextAreaField-gqWFHccd.js";import{r as Le}from"./resizeImage-evQm2Wth.js";import{u as De}from"./useErrorFocusFields-f_sEGw1K.js";import{O as Ae}from"./OverLayLoader-99r8EyDV.js";import{u as qe}from"./usePathWisePermission-_z9uI2HY.js";import"./axios-lPgvryBG.js";import"./reactIcons-lANGEfNm.js";import"./headlessui-pLs_kC1m.js";import"./customInputValidation-8tSUGdUh.js";import"./module-UYcpCVqk.js";const K=[{label:"Yes",value:"yes"},{label:"No",value:"no"}],Be=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}],Re=[{docname:"isPhotoDoc",label:"Photograph"},{docname:"isIdProofDoc",label:"Id Proof"},{docname:"isApplicationFormDoc",label:"Application Form"},{docname:"isSaleDeedDoc",label:"Sale Deed"},{docname:"isMeasurementDoc",label:"Measurement"},{docname:"isLayoutSactionMapDoc",label:"Layout Saction Map"},{docname:"isNaOrderDoc",label:"NA Order"},{docname:"isNamunaDDoc",label:"7/12/Namuna D"},{docname:"isOthersDoc",label:"Others"}];function Oe(n){var l,M,E,A,q,B,F,$;be();const{mutateAsync:_,isLoading:o}=J({}),v=J({});J({});const s=me({enableReinitialize:!0,validationSchema:Q().shape({name:j().required("Name is required"),mobile:j().required("Mobile is required"),zoneId:j().required("Zone is required"),wardId:j().required().label("Ward"),address:j().required("Address is required"),propertyType:j().required("Property Type is required"),consumerNo:j().when("isConsumer",{is:r=>r==="yes",then:()=>j().required("Consumer No is required")}),licenseNo:j().when("isLicense",{is:r=>r==="yes",then:()=>j().required("License No is required")}),waterHarvestingDate:j().when("isWaterHarvesting",{is:r=>r==="yes",then:()=>j().required("Date is required")}),isPhotoDoc:j().matches(/yes/,"Required"),isIdProofDoc:j().matches(/yes/,"Required"),isApplicationFormDoc:j().matches(/yes/,"Required"),isSaleDeedDoc:j().matches(/yes/,"Required")}),initialValues:n==null?void 0:n.data,onSubmit:async(r,{})=>{console.log(r),n==null||n.next({...n==null?void 0:n.data,...r},!1)}}),{values:h}=s,{data:T,isPending:P,isError:D,error:C,isLoading:I}=Y({api:L.getWardByZone,config:{zoneId:h==null?void 0:h.zoneId},value:[h==null?void 0:h.zoneId],options:{enabled:!!(h!=null&&h.zoneId)}}),w=Y({api:L.masterSaf,config:{},options:{enabled:!0}}),u=async()=>{var r,p,N;try{const i=await v.mutateAsync({api:L.consumerVerify,data:{consumerNo:(r=s==null?void 0:s.values)==null?void 0:r.consumerNo}});(p=i==null?void 0:i.data)!=null&&p.status?(n==null||n.setConsumerDetails((N=i==null?void 0:i.data)==null?void 0:N.data),S.success("Consumer Verified")):S.error("Consumer not found")}catch(i){S.error(i.message)}},d=async()=>{var r,p,N;try{const i=await v.mutateAsync({api:L.tradeVerify,data:{licenseNo:(r=s==null?void 0:s.values)==null?void 0:r.licenseNo}});(p=i==null?void 0:i.data)!=null&&p.status?(n==null||n.setLicenseDetails((N=i==null?void 0:i.data)==null?void 0:N.data),S.success("License Verified")):(console.log(i==null?void 0:i.data),S.error("License not found"))}catch(i){S.error(i.message)}},t=Y({api:L.getAptByWard,config:{wardMstrId:h==null?void 0:h.wardId},value:[h==null?void 0:h.wardId],options:{enabled:((l=s.values)==null?void 0:l.propertyType)==3}});return e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"Basic Details"})}),e.jsx(b.Card,{children:e.jsx("div",{className:"p-4",children:e.jsx(ue,{formik:s,children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx("div",{children:e.jsx(H,{isRequiredLabel:!0,disabled:!0,label:"Property Owner Name",name:"name",type:"text",formik:s,placeholder:"Enter property owner name"})}),e.jsx(H,{isRequiredLabel:!0,label:"Mobile",name:"mobile",type:"text",formik:s,placeholder:"Enter your mobile number",onInput:r=>{r.target.value.length>10?r.target.value=r.target.value.slice(0,10):r.target.value=r.target.value.replace(/[^0-9]/g,"")}}),e.jsxs(Z,{disabled:!0,label:"Zone",name:"zoneId",formik:s,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"select"}),Be.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.id))]}),e.jsxs("div",{children:[e.jsxs(Z,{isRequiredLabel:!0,label:"Ward",formik:s,name:"wardId",disabled:!0,children:[e.jsx("option",{value:"",children:"select"}),(M=T==null?void 0:T.data)==null?void 0:M.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.ward_name},r==null?void 0:r.id))]}),e.jsx("small",{className:"text-blue-500",children:I?"Please wait...":""})]}),e.jsxs(Z,{isRequiredLabel:!0,label:"Property Type",disabled:!0,name:"propertyType",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),(q=(A=(E=w==null?void 0:w.data)==null?void 0:E.data)==null?void 0:A.property_type)==null?void 0:q.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.property_type},r==null?void 0:r.id))]}),((B=s==null?void 0:s.values)==null?void 0:B.propertyType)==3&&e.jsxs(Z,{label:"Apartment",disabled:!0,name:"apartmentId",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),($=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:$.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.apartment_name},r==null?void 0:r.id))]}),e.jsx(H,{isRequiredLabel:!0,label:"Address",disabled:!0,name:"address",type:"text",formik:s,placeholder:"Enter your address"}),e.jsx(Z,{label:"Is Water Connection?",name:"isConsumer",formik:s,children:K.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isConsumer==="yes"&&e.jsx(H,{isRequiredLabel:!0,onBlur:u,label:"Consumer No",name:"consumerNo",type:"text",formik:s,placeholder:"Enter your consumer number"}),e.jsx(Z,{label:"Is Trade License?",name:"isLicense",formik:s,children:K.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isLicense==="yes"&&e.jsx(H,{isRequiredLabel:!0,label:"License No",onBlur:d,name:"licenseNo",type:"text",formik:s,placeholder:"Enter your license number"}),e.jsx(Z,{label:"Is Water Harvesting?",name:"isWaterHarvesting",formik:s,children:K.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isWaterHarvesting==="yes"&&e.jsx(H,{isRequiredLabel:!0,label:"Water Harvesting Date",name:"waterHarvestingDate",type:"date",formik:s}),e.jsx("h1",{className:"text-xs font-semibold",children:"Please select the document you have"}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Re.map(r=>{var p,N,i,R,O;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"checkbox",name:r.docname,value:(p=s==null?void 0:s.values)==null?void 0:p[r.docname],checked:((N=s==null?void 0:s.values)==null?void 0:N[r.docname])==="yes",onChange:V=>{s.setFieldValue(r.docname,V.target.checked?"yes":"no")}}),e.jsxs("h1",{className:"text-xs font-semibold",children:[r.label,(r.docname==="isPhotoDoc"||(r==null?void 0:r.docname)=="isIdProofDoc"||(r==null?void 0:r.docname)=="isApplicationFormDoc"||(r==null?void 0:r.docname)=="isSaleDeedDoc")&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-red-500",children:" *"}),e.jsx("div",{className:"text-red-500 text-[10px]",children:((i=s==null?void 0:s.errors)==null?void 0:i[r.docname])&&((R=s==null?void 0:s.touched)==null?void 0:R[r.docname])&&((O=s==null?void 0:s.errors)==null?void 0:O[r.docname])})]})]})]},r.docname)})}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(b.Button,{size:"sm",type:"submit",color:"blue",loading:o,formik:s,fullWidth:!0,label:"Submit",children:"Next"})})]})})})})]})}function We(n){var P,D,C,I,w,u;y.useState(!1),y.useState({});const{data:_,consumerDetails:o,licenseDetails:v,dataFromDb:s}=n,h=()=>{n.next({..._,..._},!1)},T=()=>{n.prev({..._,..._})};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-600",children:"View Details"}),e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Basic Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(P=s==null?void 0:s.property_no)!=null?P:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(D=s==null?void 0:s.holding_no)!=null?D:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Zone: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(C=s==null?void 0:s.zone_name)!=null?C:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ward No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=s==null?void 0:s.ward_no)!=null?I:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Date of Purchase: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.land_occupation_date)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ownership Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.ownership_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.property_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.holding_type)||"-"})})]})})]}),(o==null?void 0:o.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.building_type})]})]})})})})]})]}),(o==null?void 0:o.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:o==null?void 0:o.building_type})]})]})})})})]})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Property Address & Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Survey No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.khata_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Plot No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.plot_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mauja Name: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.village_mauja_name)||"--"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xs font-semibold",children:["Area Of Plot (in Sq ft) :"," "]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.area_of_plot)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.prop_address)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Corresponding Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.corr_address)||"--"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Owner Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Gender"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DOB"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Relation"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Mobile No."}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Aadhar"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Pan"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Email"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Armed-Force"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Specially-Abled?"}),e.jsx("td",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(w=s==null?void 0:s.owners)==null?void 0:w.map((d,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.owner_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.owner_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(d==null?void 0:d.gender)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(d==null?void 0:d.dob)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(d==null?void 0:d.guardian_name)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.guardian_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.relation_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.mobile_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.aadhar_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.pan_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.email}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d!=null&&d.is_armed_force?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d!=null&&d.is_specially_abled?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},t))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Floor Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Floor Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Usage Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Occupancy Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Built up Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Carpet Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Construction Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(u=s==null?void 0:s.floors)==null?void 0:u.map((d,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.floor_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.usage_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.occupancy_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.builtup_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.carpet_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:d==null?void 0:d.construction_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},t+1))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs("div",{className:"flex justify-center mt-4 gap-4",children:[e.jsx(b.Button,{color:"blue-gray",onClick:T,className:"px-8",size:"sm",children:"Back"}),e.jsx(b.Button,{color:"blue",onClick:h,className:"px-8",size:"sm",children:"Next"})]})]})}function ze(n){var r,p,N,i,R,O,V,X,k,ee,se,re;Ne();const[_,o]=y.useState(""),{AutoFocusErrorField:v}=De(),[s,h]=y.useState([]),T=be(),P=J({}),[D,C]=y.useState(null),{id:I}=je(),{pathname:w}=_e();qe((p=(r=w==null?void 0:w.split("/"))==null?void 0:r.slice(0,-1))==null?void 0:p.join("/"));const{coords:u,isGeolocationEnabled:d}=ye(),t=Y({api:L.staticSafDetail,config:{applicationId:I},value:[I],options:{enabled:!!I}});Y({api:(N=fe)==null?void 0:N.workFlowInfo,config:{workflowId:(R=(i=t==null?void 0:t.data)==null?void 0:i.data)==null?void 0:R.workflow_id},value:[(V=(O=t==null?void 0:t.data)==null?void 0:O.data)==null?void 0:V.workflow_id],options:{enabled:!!((k=(X=t==null?void 0:t.data)==null?void 0:X.data)!=null&&k.workflow_id)}});const l=me({enableReinitialize:!0,initialValues:{...n==null?void 0:n.data,geoTagged:(se=(ee=n==null?void 0:n.data)==null?void 0:ee.geoTagged)==null?void 0:se.map(a=>({...a})),comment:((re=n==null?void 0:n.data)==null?void 0:re.comment)||""},validationSchema:Q().shape({geoTagged:Ie().of(Q().shape({latitude:j().required("Latitude is required"),longitude:j().required("Longitude is required"),directionType:j().required("Direction is required"),imagePath:Se().required("Image is required")}))}),onSubmit:async a=>{ge.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the survey. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(g=>{g.isConfirmed&&M(a)}).catch(g=>{var x,f;console.log(g),S.error((f=(x=g==null?void 0:g.response)==null?void 0:x.data)==null?void 0:f.message)})}}),M=async a=>{var g,x,f;try{const m=await(P==null?void 0:P.mutateAsync({api:L.surveyReassessment,data:{propId:I,propertyType:a==null?void 0:a.propertyType,apartmentId:a==null?void 0:a.apartmentId,propAddress:a==null?void 0:a.address,mobileNo:a==null?void 0:a.mobile,ownerName:a==null?void 0:a.name,ward:a==null?void 0:a.wardId,zone:a==null?void 0:a.zoneId,consumerNo:a==null?void 0:a.consumerNo,licenseNo:a==null?void 0:a.licenseNo,isWaterHarvesting:(a==null?void 0:a.isWaterHarvesting)=="yes",harvestingDate:a==null?void 0:a.waterHarvestingDate,isApplicationFormDoc:(a==null?void 0:a.isApplicationFormDoc)=="yes",isSaleDeedDoc:(a==null?void 0:a.isSaleDeedDoc)=="yes",isLayoutSactionMapDoc:(a==null?void 0:a.isLayoutSactionMapDoc)=="yes",isNaOrderDoc:(a==null?void 0:a.isNaOrderDoc)=="yes",isNamunaDDoc:(a==null?void 0:a.isNamunaDDoc)=="yes",isOthersDoc:(a==null?void 0:a.isOthersDoc)=="yes",isMeasurementDoc:(a==null?void 0:a.isMeasurementDoc)=="yes",isPhotoDoc:(a==null?void 0:a.isPhotoDoc)=="yes",isIdProofDoc:(a==null?void 0:a.isIdProofDoc)=="yes"}}));(g=m==null?void 0:m.data)!=null&&g.status&&await E(a,(f=(x=m==null?void 0:m.data)==null?void 0:x.data)==null?void 0:f.safId)}catch(m){console.log(m)}},E=async(a,g)=>{var f,m,W,z,U;const x=new FormData;x.append("safId",g),a==null||a.geoTagged.forEach((c,G)=>{x.append("latitude[".concat(G,"]"),c==null?void 0:c.latitude),x.append("longitude[".concat(G,"]"),c==null?void 0:c.longitude),x.append("directionType[".concat(G,"]"),c==null?void 0:c.directionType),x.append("imagePath[".concat(G,"]"),c==null?void 0:c.imagePath)});try{const c=await P.mutateAsync({api:L.geoTagging,data:x});(f=c==null?void 0:c.data)!=null&&f.status?(S.success((m=c==null?void 0:c.data)==null?void 0:m.message),T("/amc-app/property/saf-generated-new/".concat(g),{replace:!0})):S.error((W=c==null?void 0:c.data)==null?void 0:W.message)}catch(c){S.error((U=(z=c==null?void 0:c.response)==null?void 0:z.data)==null?void 0:U.message)}},{submitCount:A,isSubmitting:q,errors:B,isValid:F}=l,$=async(a,g,x)=>{var W,z;await((W=window==null?void 0:window.ReactNativeWebView)==null?void 0:W.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const f=await Le(a.target.files[0]),m=new File([f],(z=a.target.files[0])==null?void 0:z.name,{type:"image/*"});l.setFieldValue("geoTagged.".concat(g,".latitude"),u==null?void 0:u.latitude),l.setFieldValue("geoTagged.".concat(g,".longitude"),u==null?void 0:u.longitude),l.setFieldValue("geoTagged.".concat(g,".directionType"),x==null?void 0:x.directionType),l.setFieldValue("geoTagged.".concat(g,".imagePath"),m),C(m)};return ve.useEffect(()=>{var a;h(((a=n==null?void 0:n.data)==null?void 0:a.isWaterHarvesting)=="yes"?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[n==null?void 0:n.data]),y.useEffect(()=>{v({submitCount:A,isSubmitting:q,errors:B,isValid:F})},[B,A,q]),d||ge.fire({text:"Geolocation is not enabled! Please enable to use this app",icon:"error",confirmButtonText:"Ok"}),_?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):t!=null&&t.isLoading?e.jsx(we,{}):e.jsxs(e.Fragment,{children:[P.isLoading&&e.jsx(Ae,{}),e.jsx("div",{children:e.jsxs(ue,{formik:l,children:[e.jsx(Pe,{name:"geoTagged",children:a=>s.map((g,x)=>{var f,m,W,z,U,c,G,ae,te,de,ne,le,oe,ie,ce,xe,he;return e.jsxs(y.Fragment,{children:[e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:g==null?void 0:g.title})}),e.jsxs(b.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(H,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(x,".latitude"),formik:l}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(H,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(x,".longitude"),formik:l})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((m=(f=l==null?void 0:l.values)==null?void 0:f.geoTagged[x])==null?void 0:m.imagePath)&&e.jsx("img",{className:"w-full h-64",loading:"lazy",src:(z=(W=l==null?void 0:l.values)==null?void 0:W.geoTagged[x])!=null&&z.imagePath?URL.createObjectURL((c=(U=l==null?void 0:l.values)==null?void 0:U.geoTagged[x])==null?void 0:c.imagePath):null,alt:(te=(ae=(G=l==null?void 0:l.values)==null?void 0:G.geoTagged[x])==null?void 0:ae.imagePath)==null?void 0:te.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:pe=>$(pe,x,g)}),e.jsx("span",{className:"text-sm text-red-500",children:(le=(ne=(de=l==null?void 0:l.errors)==null?void 0:de.geoTagged)==null?void 0:ne[x])==null?void 0:le.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((ie=(oe=l==null?void 0:l.values)==null?void 0:oe.geoTagged[x])==null?void 0:ie.imagePath)&&Math.round(((he=(xe=(ce=l==null?void 0:l.values)==null?void 0:ce.geoTagged[x])==null?void 0:xe.imagePath)==null?void 0:he.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},x)})}),e.jsx(Ce,{name:"comment",label:"Comment",formik:l}),e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-3",children:[e.jsx(b.Button,{type:"button",onClick:()=>{var a;n==null||n.prev({...n==null?void 0:n.data,geoTagged:(a=l==null?void 0:l.values)==null?void 0:a.geoTagged})},size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Back"})}),e.jsx(b.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Final Submit"})})]})]})})]})}function ns(){const{id:n}=je(),[_,o]=y.useState(0),[v,s]=y.useState({name:"",mobile:"",zoneId:"",wardId:"",address:"",isConsumer:"no",isLicense:"no",consumerNo:"",licenseNo:"",propertyType:"",apartmentId:"",isWaterHarvesting:"no",waterHarvestingDate:"",comment:"",isApplicationFormDoc:"no",isSaleDeedDoc:"no",isLayoutSactionMapDoc:"no",isNaOrderDoc:"no",isNamunaDDoc:"no",isOthersDoc:"no",isMeasurementDoc:"no",isPhotoDoc:"no",isIdProofDoc:"no",floors:[],geoTagged:[{latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}]}),[h,T]=y.useState({}),[P,D]=y.useState({});y.useState(""),y.useState("");const[C,I]=y.useState({}),w=t=>{console.log(t)},u=(t,l=!1)=>{if(s({...v,...t}),l){w(t);return}o(_+1)},d=t=>{s({...v,...t}),o(_-1)};return Y({api:L.getPropByHolding,config:{propertyId:n},value:[n],options:{enabled:!!n,onSuccess:t=>{I(t==null?void 0:t.data),s(l=>{var M,E,A,q,B,F,$,r,p,N,i,R,O,V;return{...l,name:(M=t==null?void 0:t.data)==null?void 0:M.owner_name,mobile:(E=t==null?void 0:t.data)==null?void 0:E.mobile_no,zoneId:(A=t==null?void 0:t.data)==null?void 0:A.zone_mstr_id,wardId:(q=t==null?void 0:t.data)==null?void 0:q.ward_mstr_id,propertyType:(B=t==null?void 0:t.data)==null?void 0:B.prop_type_mstr_id,apartmentId:(F=t==null?void 0:t.data)==null?void 0:F.apartment_details_id,address:($=t==null?void 0:t.data)==null?void 0:$.prop_address,isWaterHarvesting:(r=t==null?void 0:t.data)!=null&&r.is_water_harvesting?"yes":"no",waterHarvestingDate:(p=t==null?void 0:t.data)==null?void 0:p.rwh_date_from,isConsumer:((N=t==null?void 0:t.data)==null?void 0:N.water_conn_no)!=""?"yes":"no",consumerNo:(i=t==null?void 0:t.data)==null?void 0:i.water_conn_no,isLicense:(R=t==null?void 0:t.data)!=null&&R.license_no?"yes":"no",licenseNo:((O=t==null?void 0:t.data)==null?void 0:O.license_no)||"",floors:(V=t==null?void 0:t.data)==null?void 0:V.floors}})}}}),e.jsx(Te,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-4 py-6 flex-1",children:e.jsx("div",{children:{0:e.jsx(Oe,{next:u,data:v,setData:s,setConsumerDetails:T,setLicenseDetails:D,dataFromDb:C}),1:e.jsx(We,{next:u,prev:d,data:v,setData:s,setConsumerDetails:T,consumerDetails:h,licenseDetails:P,setLicenseDetails:D,dataFromDb:C}),2:e.jsx(ze,{next:u,prev:d,data:v,setData:s,setConsumerDetails:T,consumerDetails:h,setLicenseDetails:D,dataFromDb:C})}[_]})})})}export{ns as default};
