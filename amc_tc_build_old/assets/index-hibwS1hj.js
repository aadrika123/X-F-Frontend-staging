import{e as Sa,d as Fa,Q as s,S as fa,f as y,c as I,p as Pa,j as i}from"./index-7QBdU1I7.js";import{P as Ra}from"./index-qSosUdwd.js";import{u as la,d as qa}from"./router-5yjtezO8.js";import{u as ka}from"./formik.esm-BnzrXcQN.js";import{c as Ba,a as x}from"./index.esm-uHa2PMRf.js";import{F as La}from"./FormProvider-d0ogBXH-.js";import{T as c}from"./TextField-COM6IjYg.js";import{S as ja}from"./SelectField-i3npi8VO.js";import{T as wa}from"./TextAreaField-akg-9zV4.js";import"./index-iFVn5AxS.js";import{r as Va}from"./resizeImage-Wz6YeOHU.js";import{r as w}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";const Ta=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function Za({getConsumerDtl:a,getDemandDtl:h,id:o}){var _,A,S,F,P,R,l,q,k,B,L,V,T,Z,W,E,M,G,O,Y,$,H,J,K,Q,U,X,g,v,u,C,D,aa,da,ia,ea,na,oa,ra,ca,pa,ta,ma,ba,Na;const ya=la(),{coords:N,isGeolocationEnabled:z,isGeolocationAvailable:Ia}=Sa(),za=Fa({}),[Wa,_a]=qa.useState(null),e=ka({enableReinitialize:!0,initialValues:{consumerId:o||0,zoneName:((A=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:A.zone_name)||"",zoneId:((F=(S=a==null?void 0:a.data)==null?void 0:S.data)==null?void 0:F.zone_mstr_id)||"",wardId:((R=(P=a==null?void 0:a.data)==null?void 0:P.data)==null?void 0:R.ward_mstr_id)||"",wardName:((q=(l=a==null?void 0:a.data)==null?void 0:l.data)==null?void 0:q.ward_number)||"",holdingNo:((B=(k=a==null?void 0:a.data)==null?void 0:k.data)==null?void 0:B.holding_no)||"",propertyNo:((V=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:V.folio_no)||"",ConsumerNo:((Z=(T=a==null?void 0:a.data)==null?void 0:T.data)==null?void 0:Z.consumer_no)||"",applicantName:((E=(W=a==null?void 0:a.data)==null?void 0:W.data)==null?void 0:E.applicant_name)||"",category:((G=(M=a==null?void 0:a.data)==null?void 0:M.data)==null?void 0:G.category)||"",meterNo:((Y=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:Y.meter_no)||"",mobileNo:((H=($=a==null?void 0:a.data)==null?void 0:$.data)==null?void 0:H.mobile_no)||"",meterReading:((K=(J=a==null?void 0:a.data)==null?void 0:J.data)==null?void 0:K.meter_reading)||"",address:((U=(Q=a==null?void 0:a.data)==null?void 0:Q.data)==null?void 0:U.address)||"",demandAmount:((g=(X=h==null?void 0:h.data)==null?void 0:X.data)==null?void 0:g.totalSumDemand)||"",latitude:"",longitude:"",document:"",remarks:"",citizenComment:""},validationSchema:Ba().shape({zoneId:x().required("Zone is required"),wardId:x().required("Ward is required"),latitude:x().required("Latitude is required"),longitude:x().required("Longitude is required"),document:x().required("Document is required"),remarks:x().required("Remark is required")}),onSubmit:async(d,{resetForm:j})=>{if(!z)return s.error("Please enable location service");const n=new FormData;n.append("consumerId",d==null?void 0:d.consumerId),n.append("zoneId",d==null?void 0:d.zoneId),n.append("wardId",d==null?void 0:d.wardId),n.append("holdingNo",d==null?void 0:d.holdingNo),n.append("propertyNo",d==null?void 0:d.propertyNo),n.append("applicantName",d==null?void 0:d.applicantName),n.append("mobileNo",d==null?void 0:d.mobileNo),n.append("address",d==null?void 0:d.address),n.append("ConsumerNo",d==null?void 0:d.ConsumerNo),n.append("category",d==null?void 0:d.category),n.append("meterNo",d==null?void 0:d.meterNo),n.append("meterReading",d==null?void 0:d.meterReading),n.append("latitude",d==null?void 0:d.latitude),n.append("longitude",d==null?void 0:d.longitude),n.append("document",d==null?void 0:d.document),n.append("remarks",d==null?void 0:d.remarks),n.append("citizenComment",d==null?void 0:d.citizenComment),n.append("demandAmount",d==null?void 0:d.demandAmount),fa.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async t=>{var m,b,xa,ha,sa;if(t.isConfirmed)try{const r=await za.mutateAsync({api:y.addWaterTcVisit,data:n});(m=r==null?void 0:r.data)!=null&&m.status?(s.success((b=r==null?void 0:r.data)==null?void 0:b.message),j(),a.remove(),demandDetails.remove(),ya("/amc-app/water/search-consumer",{replace:!0})):s.error((xa=r==null?void 0:r.data)==null?void 0:xa.message)}catch(r){s.error((sa=(ha=r==null?void 0:r.response)==null?void 0:ha.data)==null?void 0:sa.message)}}).catch(t=>{var m,b;console.log(t),s.error((b=(m=t==null?void 0:t.response)==null?void 0:m.data)==null?void 0:b.message)})}}),{values:p}=e,{data:f,isPending:Ea,isError:Ma,error:Ga,isLoading:Oa}=I({api:Pa.getWardByZone,config:{zoneId:p==null?void 0:p.zoneId},value:[p==null?void 0:p.zoneId],options:{enabled:!!(p!=null&&p.zoneId)}}),Aa=async d=>{var t,m,b;if(!((t=d.target)!=null&&t.files[0]))return;await((m=window==null?void 0:window.ReactNativeWebView)==null?void 0:m.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const j=await Va(d.target.files[0]),n=new File([j],(b=d.target.files[0])==null?void 0:b.name,{type:"image/*"});e.setFieldValue("latitude",N==null?void 0:N.latitude),e.setFieldValue("longitude",N==null?void 0:N.longitude),e.setFieldValue("document",n),_a(n)};return i.jsx(w.Card,{children:i.jsx(w.CardBody,{color:"blue",children:i.jsxs(La,{formik:e,children:[i.jsx("div",{className:"p-2",children:i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-6",children:[i.jsxs(ja,{name:"zoneId",label:"Zone Name",formik:e,disabled:o,children:[i.jsx("option",{value:"",children:"Select Zone"}),Ta.map(d=>i.jsx("option",{value:d.value,children:d.label},d.id))]}),i.jsxs(ja,{name:"wardId",label:"Ward Name",formik:e,disabled:o,children:[i.jsx("option",{value:"",children:"Select Ward"}),(v=f==null?void 0:f.data)==null?void 0:v.map(d=>i.jsx("option",{value:d.id,children:d.ward_name},d.id))]}),i.jsx(c,{name:"holdingNo",label:"Holding No",formik:e,disabled:o&&((C=(u=a==null?void 0:a.data)==null?void 0:u.data)==null?void 0:C.holding_no)}),i.jsx(c,{name:"propertyNo",label:"Property No",formik:e,disabled:o&&((aa=(D=a==null?void 0:a.data)==null?void 0:D.data)==null?void 0:aa.folio_no)}),i.jsx(c,{name:"applicantName",label:"Name",formik:e,disabled:o&&((ia=(da=a==null?void 0:a.data)==null?void 0:da.data)==null?void 0:ia.applicant_name)}),i.jsx(c,{name:"mobileNo",label:"Mobile No",formik:e}),i.jsx(c,{name:"address",label:"Address",formik:e,disabled:o&&((na=(ea=a==null?void 0:a.data)==null?void 0:ea.data)==null?void 0:na.address),inputValidation:["mobile"]})]}),i.jsxs("div",{className:"col-md-6",children:[i.jsx(c,{name:"ConsumerNo",label:"Consumer No",formik:e,disabled:o&&((ra=(oa=a==null?void 0:a.data)==null?void 0:oa.data)==null?void 0:ra.consumer_no)}),i.jsx(c,{name:"category",label:"Category",formik:e,disabled:o&&((pa=(ca=a==null?void 0:a.data)==null?void 0:ca.data)==null?void 0:pa.category)}),i.jsx(c,{name:"meterNo",label:"Meter No",formik:e,disabled:o&&((ma=(ta=a==null?void 0:a.data)==null?void 0:ta.data)==null?void 0:ma.meter_no)}),i.jsx(c,{name:"meterReading",label:"Meter Reading",formik:e,disabled:o&&((Na=(ba=a==null?void 0:a.data)==null?void 0:ba.data)==null?void 0:Na.meter_reading)}),i.jsx(c,{name:"demandAmount",label:"Demand Amount",formik:e,disabled:o}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"col-span-2",children:[i.jsx(c,{label:"Document",type:"file",capture:"environment",name:"document",accept:"image/*",id:"document",onChange:d=>{if(!z||!Ia){d.target.value=null,fa.fire({title:"Location Service",text:"Please enable location service",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});return}Aa(d)}}),e.errors.document&&e.touched.document?i.jsx("small",{className:"text-red-500 -mt-2",children:e.errors.document}):null]}),i.jsx("div",{children:i.jsx(c,{name:"latitude",label:"Latitude",formik:e,disabled:!0})}),i.jsx("div",{children:i.jsx(c,{name:"longitude",label:"Longitude",formik:e,disabled:!0})})]}),i.jsx(wa,{name:"remarks",label:"Remarks",formik:e}),i.jsx(wa,{name:"citizenComment",label:"Citizen Comment",formik:e})]})]})}),i.jsx("div",{className:"flex justify-center",children:i.jsx(w.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function nd(){const a=new URLSearchParams(window.location.search),h=I({api:y.waterGetDetails,config:{applicationId:a.get("id")},options:{enabled:!!a.get("id")}}),o=I({api:y.waterListDemand,config:{ConsumerId:a.get("id")},options:{enabled:!!a.get("id")}});return i.jsx(Ra,{title:"Water Visiting",children:i.jsx("div",{className:"p-2",children:i.jsx(Za,{getConsumerDtl:h,getDemandDtl:o,id:a.get("id")})})})}export{nd as default};
