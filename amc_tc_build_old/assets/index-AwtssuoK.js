import{b as Ae,a as w,w as b,S as Me,Q as j,j as a}from"./index-pk4UNAPW.js";import{u as ue,h as Ee,r as Fe,e as g,l as Ue}from"./react-rKuUt_as.js";import{u as Re}from"./formik.esm-GYaH6P80.js";import{F as Be}from"./FormProvider-aUN2PpaB.js";import{T as o}from"./TextField-9KjFgJKe.js";import{S as q}from"./SelectField-aevxMuSH.js";import"./index-7JGA4NxA.js";import{c as Ie,a as h,f as De,g as Te}from"./index.esm-ZNAGMSQQ.js";import{P as Oe}from"./index-KO8JlrUF.js";import{O as Se}from"./OverLayLoader-RO02elyj.js";import{r as _e}from"./resizeImage-7jQilsb1.js";import{u as Ve}from"./usePathWisePermission-BWI8Lo6h.js";import"./module-7wrXIbTr.js";function ta(){var F,D,T,C,A,M,u,E,U,R,B,I,O,S,_,V,Y,L,$,z,W,G,Q,H,J,K,X,Z,k,v,ee,ae,te,de,ne,se,re,me,oe,ie,ce;const s=ue(),p=Ae({}),{id:m}=Ee(),{result:N}=Ve("/amc-app/water/water-payment"),c=w({api:b.waterGetDetails,config:{applicationId:m},value:[m],options:{enabled:!!m}}),f=w({api:b.waterListDemand,config:{ConsumerId:m},value:[m],options:{enabled:!!m}}),t=Re({enableReinitialize:!0,initialValues:{consumerId:m,demandFrom:"",demandUpto:"",amount:"",paymentMode:"",remarks:"",paymentType:"isFullPayment",chequeDate:"",bankName:"",branchName:"",chequeNo:"",document:""},validationSchema:Ie().shape({demandUpto:h().required("Required"),paymentMode:h().required("Required"),chequeDate:h().when("paymentMode",{is:e=>e=="Cheque"||e=="DD"||e=="NEFT",then:()=>h().required("Required")}),bankName:h().when("paymentMode",{is:e=>e=="Cheque"||e=="DD"||e=="NEFT",then:()=>h().required("Required")}),branchName:h().when("paymentMode",{is:e=>e=="Cheque"||e=="DD"||e=="NEFT",then:()=>h().required("Required")}),chequeNo:h().when("paymentMode",{is:e=>e=="Cheque"||e=="DD"||e=="NEFT",then:()=>h().required("Required")}),document:De().when("paymentMode",{is:e=>e=="Cheque"||e=="DD"||e=="NEFT",then:()=>De().required("Required")}),paymentType:h().required("Required"),amount:Te().when("paymentType",{is:e=>e=="isPartPayment",then:()=>Te().required("Required")}),remarks:h().required("Required")}),onSubmit:async e=>{Me.fire({title:"Are you sure?",text:"You want to proceed with payment",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(r=>{r.isConfirmed&&Ce(e)}).catch(r=>{var l,x;j.error((x=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:x.message)})}}),Ce=async e=>{var r,l,x,y,xe,le,he,pe,ye,je,Ne,be,ge,fe,Pe,we,qe;if((e==null?void 0:e.paymentType)=="isPartPayment"&&(e==null?void 0:e.amount)>((l=(r=n==null?void 0:n.data)==null?void 0:r.data)==null?void 0:l.totalPayAmount)){j.error("Part payment amount is greater than total amount");return}if((e==null?void 0:e.paymentMode)=="Cheque"||(e==null?void 0:e.paymentMode)=="DD"||(e==null?void 0:e.paymentMode)=="NEFT"){const d=new FormData;d.append("consumerId",e==null?void 0:e.consumerId),d.append("demandFrom",e==null?void 0:e.demandFrom),d.append("demandUpto",e==null?void 0:e.demandUpto),d.append("amount",e==null?void 0:e.amount),d.append("paymentMode",e==null?void 0:e.paymentMode),d.append("remarks",e==null?void 0:e.remarks),d.append("paymentType",e==null?void 0:e.paymentType),d.append("chequeDate",e==null?void 0:e.chequeDate),d.append("bankName",e==null?void 0:e.bankName),d.append("branchName",e==null?void 0:e.branchName),d.append("chequeNo",e==null?void 0:e.chequeNo),d.append("document",e==null?void 0:e.document),d.append("deviceType","android");try{const i=await p.mutateAsync({api:(e==null?void 0:e.paymentType)=="isPartPayment"?b.waterPartPayment:b.waterOfflinePayment,data:d});(x=i==null?void 0:i.data)!=null&&x.status?(s("/amc-app/water/water-payment-response?response=".concat((xe=(y=i==null?void 0:i.data)==null?void 0:y.data)==null?void 0:xe.tranNo),{replace:!0}),j.success((le=i==null?void 0:i.data)==null?void 0:le.message)):j.error((he=i==null?void 0:i.data)==null?void 0:he.message)}catch(i){j.error(i==null?void 0:i.message)}return}if((e==null?void 0:e.paymentMode)=="Cash"){try{const d=await p.mutateAsync({api:(e==null?void 0:e.paymentType)=="isPartPayment"?b.waterPartPayment:b.waterOfflinePayment,data:{consumerId:e==null?void 0:e.consumerId,demandFrom:e==null?void 0:e.demandFrom,demandUpto:e==null?void 0:e.demandUpto,amount:e==null?void 0:e.amount,paymentMode:e==null?void 0:e.paymentMode,remarks:e==null?void 0:e.remarks,paymentType:e==null?void 0:e.paymentType,deviceType:"android"}});(pe=d==null?void 0:d.data)!=null&&pe.status?(s("/amc-app/water/water-payment-response?response=".concat((je=(ye=d==null?void 0:d.data)==null?void 0:ye.data)==null?void 0:je.tranNo),{replace:!0}),j.success((Ne=d==null?void 0:d.data)==null?void 0:Ne.message)):j.error((be=d==null?void 0:d.data)==null?void 0:be.message)}catch(d){j.error(d==null?void 0:d.message)}return}if((e==null?void 0:e.paymentMode)=="Online"){try{const d=await p.mutateAsync({api:b.waterOnlinePayment,data:{consumerId:e==null?void 0:e.consumerId,amount:e==null?void 0:e.amount,paymentMode:e==null?void 0:e.paymentMode,remarks:e==null?void 0:e.remarks,paymentType:e==null?void 0:e.paymentType,demandUpto:e==null?void 0:e.demandUpto,demandFrom:e==null?void 0:e.demandFrom,deviceType:"android",callbackUrl:"https://modernulb.com/amc-app/water/water-payment-history"}});(ge=d==null?void 0:d.data)!=null&&ge.status?(j.success((fe=d==null?void 0:d.data)==null?void 0:fe.message),window.location.href=(we=(Pe=d==null?void 0:d.data)==null?void 0:Pe.data)==null?void 0:we.refUrl):j.error((qe=d==null?void 0:d.data)==null?void 0:qe.message)}catch(d){j.error(d==null?void 0:d.message)}return}},n=w({api:b.calculatePriceWater,config:{consumerId:m,demandUpto:(F=t.values)==null?void 0:F.demandUpto},value:[(D=t.values)==null?void 0:D.demandUpto,m],options:{enabled:!!((T=t.values)!=null&&T.demandUpto)&&!!m,initialData:{data:{totalDemand:0,totalPenalty:0,totalAdvance:0,totalRebate:0,remaningAdvanceAmount:0,totalPayAmount:0}}}});Fe.useEffect(()=>{var e,r,l,x,y;(r=(e=n==null?void 0:n.data)==null?void 0:e.data)!=null&&r.totalPayAmount&&((l=t.values)==null?void 0:l.paymentType)=="isFullPayment"?t.setFieldValue("amount",(y=(x=n==null?void 0:n.data)==null?void 0:x.data)==null?void 0:y.totalPayAmount):t.setFieldValue("amount","")},[(A=(C=n==null?void 0:n.data)==null?void 0:C.data)==null?void 0:A.totalPayAmount,(M=t.values)==null?void 0:M.paymentType]),Fe.useEffect(()=>{var e,r,l,x,y;(((e=t==null?void 0:t.values)==null?void 0:e.paymentMode)=="Cash"||((r=t==null?void 0:t.values)==null?void 0:r.paymentMode)=="Online"||((l=t==null?void 0:t.values)==null?void 0:l.paymentMode)=="NEFT"||((x=t==null?void 0:t.values)==null?void 0:x.paymentMode)=="DD"||((y=t==null?void 0:t.values)==null?void 0:y.paymentMode)=="Cheque")&&(t.setFieldValue("chequeDate",""),t.setFieldValue("bankName",""),t.setFieldValue("branchName",""),t.setFieldValue("chequeNo",""),t.setFieldValue("document",""))},[(u=t==null?void 0:t.values)==null?void 0:u.paymentMode]);const P=async e=>{var x,y;const r=await _e(e.target.files[0]),l=new File([r],(y=(x=e==null?void 0:e.target)==null?void 0:x.files[0])==null?void 0:y.name,{type:"image/*"});t.setFieldValue("document",l)};return a.jsxs(Oe,{title:"Pay Now",children:[p.isLoading&&a.jsx(Se,{}),a.jsxs("div",{className:"p-4",children:[a.jsx(g.Card,{children:a.jsxs(g.CardBody,{children:[a.jsx("div",{className:"flex flex-row justify-between mb-3",children:a.jsx("h1",{className:"text-base font-semibold",children:"# Basic Details"})}),a.jsx("div",{className:"my-3 border-b-2"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"Applicant name:"}),a.jsx("h1",{className:"text-sm",children:(U=(E=c==null?void 0:c.data)==null?void 0:E.data)==null?void 0:U.applicant_name})]}),a.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"Property No:"}),a.jsx("h1",{className:"text-sm",children:(B=(R=c==null?void 0:c.data)==null?void 0:R.data)==null?void 0:B.folio_no})]}),a.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"Consumer No:"}),a.jsx("h1",{className:"text-sm",children:(O=(I=c==null?void 0:c.data)==null?void 0:I.data)==null?void 0:O.consumer_no})]}),a.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),a.jsx("h1",{className:"text-sm",children:((_=(S=c==null?void 0:c.data)==null?void 0:S.data)==null?void 0:_.reading_date)||"--"})]}),a.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[a.jsx("h1",{className:"text-sm font-semibold",children:"Address:"}),a.jsx("h1",{className:"text-sm w-36 truncate",children:((Y=(V=c==null?void 0:c.data)==null?void 0:V.data)==null?void 0:Y.address)||"--"})]})]})]})}),a.jsx("div",{className:"my-3 border-b-2"}),a.jsxs(g.Card,{className:"mt-4 w-full",children:[a.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:a.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Demand List"})}),a.jsx(g.CardBody,{children:a.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:a.jsxs("table",{className:"w-full text-sm text-left  border-slate-400 border",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"# Sno."}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND FROM"}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND UPTO"}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND AMOUNT"}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PENALTY"}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"CONNECTION TYPE"}),a.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PAYABLE AMOUNT"})]})}),a.jsx("tbody",{children:(z=($=(L=f==null?void 0:f.data)==null?void 0:L.data)==null?void 0:$.consumerDemands)==null?void 0:z.map((e,r)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:r+1}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.demand_from}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.demand_upto}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.balance_amount}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.penalty}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.connection_type}),a.jsx("td",{className:"text-sm p-4 border border-slate-300",children:e==null?void 0:e.amount})]},r))})]})})})]}),a.jsx("div",{className:"my-3 border-b-2"}),a.jsx(Be,{formik:t,children:a.jsxs(g.Card,{className:"mt-4 w-full",children:[a.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:a.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Payment Details"})}),a.jsxs(g.CardBody,{children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx("div",{children:a.jsxs(q,{label:"Month Upto",name:"demandUpto",formik:t,children:[a.jsx("option",{value:"",children:"Select Payment Mode"}),(Q=(G=(W=f==null?void 0:f.data)==null?void 0:W.data)==null?void 0:G.consumerDemands)==null?void 0:Q.map((e,r)=>a.jsx("option",{value:e==null?void 0:e.demand_upto,children:Ue(e==null?void 0:e.demand_upto).format("DD-MM-YYYY")},r))]})}),a.jsx("div",{children:a.jsxs(q,{label:"Payment Mode",name:"paymentMode",formik:t,children:[a.jsx("option",{value:"",children:"Select Payment Mode"}),a.jsx("option",{value:"Cash",children:"Cash"}),a.jsx("option",{value:"Cheque",children:"Cheque"}),a.jsx("option",{value:"DD",children:"DD"}),((H=t==null?void 0:t.values)==null?void 0:H.paymentType)=="isFullPayment"&&a.jsx("option",{value:"Online",children:"Online"})]})}),a.jsx("div",{className:"col-span-2",children:a.jsxs(q,{label:"Payment Type",name:"paymentType",formik:t,children:[a.jsx("option",{value:"",children:"Select Payment Type"}),a.jsx("option",{value:"isFullPayment",children:"Full Payment"}),(N==null?void 0:N.read)&&a.jsx("option",{value:"isPartPayment",children:"Part Payment"})]})}),((J=t.values)==null?void 0:J.paymentType)=="isPartPayment"&&a.jsx("div",{className:"col-span-2",children:a.jsx(o,{label:"Amount",name:"amount",type:"number",formik:t})})]}),((K=t.values)==null?void 0:K.paymentMode)=="Cheque"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"my-3 border-b-2"}),a.jsx(Ye,{formik:t,handleSelectImg:P})]}),((X=t.values)==null?void 0:X.paymentMode)=="DD"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"my-3 border-b-2"}),a.jsx(Le,{formik:t,handleSelectImg:P})]}),((Z=t.values)==null?void 0:Z.paymentMode)=="NEFT"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"my-3 border-b-2"}),a.jsx($e,{formik:t,handleSelectImg:P})]}),a.jsx("div",{className:"col-span-2 mt-3",children:a.jsx(o,{label:"Remarks",name:"remarks",type:"text",formik:t})}),a.jsx("div",{className:"my-3 border-b-2"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 ",children:[a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Total Demand:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((v=(k=n==null?void 0:n.data)==null?void 0:k.data)==null?void 0:v.totalDemand).toFixed(2)]})}),a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Penalty:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((ae=(ee=n==null?void 0:n.data)==null?void 0:ee.data)==null?void 0:ae.totalPenalty).toFixed(2)]})}),a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Advance:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((de=(te=n==null?void 0:n.data)==null?void 0:te.data)==null?void 0:de.totalAdvance).toFixed(2)]})}),a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Rebate:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((se=(ne=n==null?void 0:n.data)==null?void 0:ne.data)==null?void 0:se.totalRebate).toFixed(2)]})}),a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Remaining Advance:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((me=(re=n==null?void 0:n.data)==null?void 0:re.data)==null?void 0:me.remaningAdvanceAmount).toFixed(2)]})}),a.jsx("div",{children:a.jsx("h1",{className:"text-sm font-semibold",children:"Total Pay Amount:"})}),a.jsx("div",{className:"text-end",children:a.jsxs("h1",{className:"text-sm",children:["₹"," ",Math==null?void 0:Math.round((ie=(oe=n==null?void 0:n.data)==null?void 0:oe.data)==null?void 0:ie.totalPayAmount).toFixed(2)]})})]}),a.jsx("div",{className:"my-3 border-b-2"}),a.jsx("div",{className:"flex justify-center",children:a.jsxs(g.Button,{type:"submit",color:"blue",size:"sm",loading:p.isLoading,children:["Pay Now ",(ce=t==null?void 0:t.values)==null?void 0:ce.amount]})})]})]})})]})]})}const Ye=({formik:s,handleSelectImg:p})=>{var m;return a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("div",{children:a.jsx(o,{label:"Cheque No",name:"chequeNo",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Cheque Date",name:"chequeDate",type:"date",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Bank Name",name:"bankName",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Branch Name",name:"branchName",type:"text",formik:s})}),a.jsxs("div",{className:"col-span-2",children:[a.jsx(o,{label:"Upload Cheque Image",name:"document",type:"file",onChange:N=>p(N)}),a.jsx("small",{className:"text-red-500 -mt-6",children:(m=s==null?void 0:s.errors)==null?void 0:m.document})]})]})},Le=({formik:s,handleSelectImg:p})=>{var m;return a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("div",{children:a.jsx(o,{label:"DD No",name:"chequeNo",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"DD Date",name:"chequeDate",type:"date",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Bank Name",name:"bankName",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Branch Name",name:"branchName",type:"text",formik:s})}),a.jsxs("div",{className:"col-span-2",children:[a.jsx(o,{label:"Upload DD Image",name:"document",type:"file",onChange:N=>p(N)}),a.jsx("small",{className:"text-red-500 -mt-6",children:(m=s==null?void 0:s.errors)==null?void 0:m.document})]})]})},$e=({formik:s,handleSelectImg:p})=>{var m;return a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("div",{children:a.jsx(o,{label:"NEFT No",name:"chequeNo",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"NEFT Date",name:"chequeDate",type:"date",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Bank Name",name:"bankName",type:"text",formik:s})}),a.jsx("div",{children:a.jsx(o,{label:"Branch Name",name:"branchName",type:"text",formik:s})}),a.jsxs("div",{className:"col-span-2",children:[a.jsx(o,{label:"Upload NEFT Image",name:"document",type:"file",onChange:N=>p(N)}),a.jsx("small",{className:"text-red-500 -mt-6",children:(m=s==null?void 0:s.errors)==null?void 0:m.document})]})]})};export{ta as default};
